function unbindBeforeUnloadEvents(){$(window).unbind("beforeunload.channel"),$(document).unbind("page:before-change.channel page:before-unload.channel")}function confirmUnsavedChanges(){var e=$("#unsaved_message").val(),t=channelInfo();unbindBeforeUnloadEvents(),$(window).bind("beforeunload.channel",function(){return channelChanged(t)?e:void 0}),$(document).bind("page:before-change.channel page:before-unload.channel",function(){return channelChanged(t)&&!confirm(e)?!1:void 0})}function channelInfo(){var e=$(":text").get(),t=$(":radio:checked").get(),n=$(":checkbox").get(),a=$("textarea").get(),i=[e,a,t,n].map(function(e){return e.map(function(e){return e.value})});return i.reduce(function(e,t){return e.concat(t)})}function channelChanged(e){if(!elementPresent($("#channel_form")))return!1;if("/channels/new"===window.location.pathname)return!0;var t=channelInfo();if(e.length!==t.length)return!0;for(var n=0;n<e.length;n++)if(t[n]!==e[n])return!0;return!1}function setSchedulable(){switch($("#schedulable_templates").append($(".schedulable_template")),$("#schedulable").html(""),$("#timecontrol_schedulable_type").val()){case"TwitterAccount":$("#schedulable").append($("#thingtweet_template")),disableDateTime(!1);break;case"Thinghttp":$("#schedulable").append($("#thinghttp_template")),disableDateTime(!1);break;case"Talkback":$("#schedulable").append($("#talkback_template")),disableDateTime(!1);break;case"MatlabCode":$("#schedulable").append($("#matlab_code_template")),disableDateTime($("#timecontrol_frequency_hourly").prop("checked")===!0||$("#timecontrol_frequency_minutes").prop("checked")===!0?!0:!1)}}function setWeekdays(){var e=$("#saved_weekdays").val();e.length>0&&$.each(e.split(" "),function(e,t){$('.weekdays[value="'+t+'"]').prop("checked",!0)})}function fixDateTime(){var e=$("#timecontrol_run_at").val(),t=$("#saved_hour").val();if(e.length>0){var n=e.split(" ");$("#timecontrol_run_at").val(n[0])}if(t.length>0){var a=t.split(" ");$("#hour").val(a[0]),$("#minute").val($("#saved_minute").val()),$("#ampm").val(a[1])}}function getStartTime(){$.ajax({url:"calculate_start_time",success:function(e){var t=e.start_time;$("#minute_start_time").text(t),$("#hour").val(parseInt(t.substring(0,2),10)),$("#minute").val(t.substring(3,5)),$("#ampm").val(t.substring(6))}})}function disableDateTime(e){e?(getStartTime(),$("#frequency_div_time").hide(),$("#frequency_div_start_time").show()):($("#frequency_div_time").show(),$("#frequency_div_start_time").hide())}function recurrancyHandler(){$("#timecontrol_frequency_weekly").prop("checked")===!0?($("#frequency_once_div").hide(),$("#frequency_recurring_div_days").show(),$("#frequency_recurring_div_hours").hide(),$("#frequency_recurring_div_minutes").hide(),$("#frequency_once_div_date").hide(),$("#frequency_recurring_div_choice").show(),setTimeLabel("Time"),disableDateTime(!1)):$("#timecontrol_frequency_daily").prop("checked")===!0?($("#frequency_once_div").hide(),$("#frequency_recurring_div_hours").hide(),$("#frequency_recurring_div_minutes").hide(),$("#frequency_recurring_div_days").hide(),$("#frequency_once_div_date").hide(),$("#frequency_recurring_div_choice").show(),setTimeLabel("Time"),disableDateTime(!1)):$("#timecontrol_frequency_hourly").prop("checked")===!0?($("#frequency_once_div").hide(),$("#frequency_recurring_div_days").hide(),$("#frequency_recurring_div_minutes").hide(),$("#frequency_recurring_div_hours").show(),$("#frequency_once_div_date").hide(),$("#frequency_recurring_div_choice").show(),disableDateTime("MatlabCode"===$("#timecontrol_schedulable_type").val()?!0:!1),setTimeLabel("Start Time")):$("#timecontrol_frequency_minutes").prop("checked")===!0&&($("#frequency_once_div").hide(),$("#frequency_recurring_div_days").hide(),$("#frequency_recurring_div_hours").hide(),$("#frequency_recurring_div_minutes").show(),$("#frequency_once_div_date").hide(),$("#frequency_recurring_div_choice").show(),disableDateTime("MatlabCode"===$("#timecontrol_schedulable_type").val()?!0:!1),setTimeLabel("Start Time")),displayFuzzyTimeOptions()}function setTimeLabel(e){$("#time_label").text(e)}function setWeekdays(){var e=$("#saved_weekdays").val();e.length>0&&$.each(e.split(" "),function(e,t){$('.weekdays[value="'+t+'"]').prop("checked",!0)})}function setFrequencyOption(){$("#timecontrol_frequency_weekly").prop("checked")===!0||$("#timecontrol_frequency_daily").prop("checked")===!0||$("#timecontrol_frequency_hourly").prop("checked")===!0||$("#timecontrol_frequency_minutes").prop("checked")===!0?$("#frequency_recurrance").attr("checked",!0):$("#frequency_once").attr("checked",!0),frequencyHandler()}function frequencyHandler(){$("#frequency_once").prop("checked")===!0?($("#frequency_recurring_div").hide(),$("#frequency_once_div").show(),$("#frequency_recurring_div_choice").hide(),$("#frequency_once_div_date").show(),$("#frequency_recurring_div_hours").hide(),$("#frequency_recurring_div_minutes").hide(),$("#frequency_recurring_div_days").hide(),setTimeLabel("Time"),disableDateTime(!1)):$("#frequency_recurrance").prop("checked")===!0&&($("#frequency_once_div").hide(),$("#frequency_recurring_div").show(),$("#frequency_once_div_date").hide(),$("#frequency_recurring_div_choice").show(),$("input:radio[class='recurrance_radio']").is(":checked")||$("#timecontrol_frequency_weekly").attr("checked",!0),recurrancyHandler())}function displayFuzzyTimeOptions(){if($("#timecontrol_frequency_minutes").prop("checked")===!0&&$("#frequency_once").prop("checked")===!1){recurring_minute=$("#timecontrol_recurring_minute").prop("selectedOptions")[0];var e=recurring_minute.value/2;e=60*e,$("#fuzzy_time option").each(function(){$(this).val()<e?$(this).show():$(this).hide()}),$("#fuzzy_time").val($("#fuzzy_time option:first").val())}else $("#fuzzy_time option").each(function(){$(this).show()})}!function(e,t){e.rails!==t&&e.error("jquery-ujs has already been loaded!");var n,a=e(document);e.rails=n={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with]",buttonClickSelector:"button[data-remote]",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]",linkDisableSelector:"a[data-disable-with]",CSRFProtection:function(t){var n=e('meta[name="csrf-token"]').attr("content");n&&t.setRequestHeader("X-CSRF-Token",n)},fire:function(t,n,a){var i=e.Event(n);return t.trigger(i,a),i.result!==!1},confirm:function(e){return confirm(e)},ajax:function(t){return e.ajax(t)},href:function(e){return e.attr("href")},handleRemote:function(a){var i,r,s,o,l,u,d,c;if(n.fire(a,"ajax:before")){if(o=a.data("cross-domain"),l=o===t?null:o,u=a.data("with-credentials")||null,d=a.data("type")||e.ajaxSettings&&e.ajaxSettings.dataType,a.is("form")){i=a.attr("method"),r=a.attr("action"),s=a.serializeArray();var h=a.data("ujs:submit-button");h&&(s.push(h),a.data("ujs:submit-button",null))}else a.is(n.inputChangeSelector)?(i=a.data("method"),r=a.data("url"),s=a.serialize(),a.data("params")&&(s=s+"&"+a.data("params"))):a.is(n.buttonClickSelector)?(i=a.data("method")||"get",r=a.data("url"),s=a.serialize(),a.data("params")&&(s=s+"&"+a.data("params"))):(i=a.data("method"),r=n.href(a),s=a.data("params")||null);c={type:i||"GET",data:s,dataType:d,beforeSend:function(e,i){return i.dataType===t&&e.setRequestHeader("accept","*/*;q=0.5, "+i.accepts.script),n.fire(a,"ajax:beforeSend",[e,i])},success:function(e,t,n){a.trigger("ajax:success",[e,t,n])},complete:function(e,t){a.trigger("ajax:complete",[e,t])},error:function(e,t,n){a.trigger("ajax:error",[e,t,n])},crossDomain:l},u&&(c.xhrFields={withCredentials:u}),r&&(c.url=r);var f=n.ajax(c);return a.trigger("ajax:send",f),f}return!1},handleMethod:function(a){var i=n.href(a),r=a.data("method"),s=a.attr("target"),o=e("meta[name=csrf-token]").attr("content"),l=e("meta[name=csrf-param]").attr("content"),u=e('<form method="post" action="'+i+'"></form>'),d='<input name="_method" value="'+r+'" type="hidden" />';l!==t&&o!==t&&(d+='<input name="'+l+'" value="'+o+'" type="hidden" />'),s&&u.attr("target",s),u.hide().append(d).appendTo("body"),u.submit()},disableFormElements:function(t){t.find(n.disableSelector).each(function(){var t=e(this),n=t.is("button")?"html":"val";t.data("ujs:enable-with",t[n]()),t[n](t.data("disable-with")),t.prop("disabled",!0)})},enableFormElements:function(t){t.find(n.enableSelector).each(function(){var t=e(this),n=t.is("button")?"html":"val";t.data("ujs:enable-with")&&t[n](t.data("ujs:enable-with")),t.prop("disabled",!1)})},allowAction:function(e){var t,a=e.data("confirm"),i=!1;return a?(n.fire(e,"confirm")&&(i=n.confirm(a),t=n.fire(e,"confirm:complete",[i])),i&&t):!0},blankInputs:function(t,n,a){var i,r,s=e(),o=n||"input,textarea",l=t.find(o);return l.each(function(){if(i=e(this),r=i.is("input[type=checkbox],input[type=radio]")?i.is(":checked"):i.val(),!r==!a){if(i.is("input[type=radio]")&&l.filter('input[type=radio]:checked[name="'+i.attr("name")+'"]').length)return!0;s=s.add(i)}}),s.length?s:!1},nonBlankInputs:function(e,t){return n.blankInputs(e,t,!0)},stopEverything:function(t){return e(t.target).trigger("ujs:everythingStopped"),t.stopImmediatePropagation(),!1},disableElement:function(e){e.data("ujs:enable-with",e.html()),e.html(e.data("disable-with")),e.bind("click.railsDisable",function(e){return n.stopEverything(e)})},enableElement:function(e){e.data("ujs:enable-with")!==t&&(e.html(e.data("ujs:enable-with")),e.removeData("ujs:enable-with")),e.unbind("click.railsDisable")}},n.fire(a,"rails:attachBindings")&&(e.ajaxPrefilter(function(e,t,a){e.crossDomain||n.CSRFProtection(a)}),a.delegate(n.linkDisableSelector,"ajax:complete",function(){n.enableElement(e(this))}),a.delegate(n.linkClickSelector,"click.rails",function(a){var i=e(this),r=i.data("method"),s=i.data("params");if(!n.allowAction(i))return n.stopEverything(a);if(i.is(n.linkDisableSelector)&&n.disableElement(i),i.data("remote")!==t){if(!(!a.metaKey&&!a.ctrlKey||r&&"GET"!==r||s))return!0;var o=n.handleRemote(i);return o===!1?n.enableElement(i):o.error(function(){n.enableElement(i)}),!1}return i.data("method")?(n.handleMethod(i),!1):void 0}),a.delegate(n.buttonClickSelector,"click.rails",function(t){var a=e(this);return n.allowAction(a)?(n.handleRemote(a),!1):n.stopEverything(t)}),a.delegate(n.inputChangeSelector,"change.rails",function(t){var a=e(this);return n.allowAction(a)?(n.handleRemote(a),!1):n.stopEverything(t)}),a.delegate(n.formSubmitSelector,"submit.rails",function(a){var i=e(this),r=i.data("remote")!==t,s=n.blankInputs(i,n.requiredInputSelector),o=n.nonBlankInputs(i,n.fileInputSelector);if(!n.allowAction(i))return n.stopEverything(a);if(s&&i.attr("novalidate")==t&&n.fire(i,"ajax:aborted:required",[s]))return n.stopEverything(a);if(r){if(o){setTimeout(function(){n.disableFormElements(i)},13);var l=n.fire(i,"ajax:aborted:file",[o]);return l||setTimeout(function(){n.enableFormElements(i)},13),l}return n.handleRemote(i),!1}setTimeout(function(){n.disableFormElements(i)},13)}),a.delegate(n.formInputClickSelector,"click.rails",function(t){var a=e(this);if(!n.allowAction(a))return n.stopEverything(t);var i=a.attr("name"),r=i?{name:i,value:a.val()}:null;a.closest("form").data("ujs:submit-button",r)}),a.delegate(n.formSubmitSelector,"ajax:beforeSend.rails",function(t){this==t.target&&n.disableFormElements(e(this))}),a.delegate(n.formSubmitSelector,"ajax:complete.rails",function(t){this==t.target&&n.enableFormElements(e(this))}),e(function(){var t=e("meta[name=csrf-token]").attr("content"),n=e("meta[name=csrf-param]").attr("content");e('form input[name="'+n+'"]').val(t)}))}(jQuery),function(e){e.cookie=function(t,n,a){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(n))||null===n||void 0===n)){if(a=e.extend({},a),(null===n||void 0===n)&&(a.expires=-1),"number"==typeof a.expires){var i=a.expires,r=a.expires=new Date;r.setDate(r.getDate()+i)}return n=String(n),document.cookie=[encodeURIComponent(t),"=",a.raw?n:encodeURIComponent(n),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}a=n||{};for(var s,o=a.raw?function(e){return e}:decodeURIComponent,l=document.cookie.split("; "),u=0;s=l[u]&&l[u].split("=");u++)if(o(s[0])===t)return o(s[1]||"");return null}}(jQuery),function(){var e,t,n,a,i,r,s,o,l,u,d,c,h,f,p,m,g,_,v,y,b,w,$,x,k,T,D,C,E,S,M,q,A,L,F,j,O,I,R,U,N,P,z,H,V,B,Y,X,W,Q,G,J,K,Z,et,tt,nt=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},at=function(e,t){function n(){this.constructor=e}for(var a in t)it.call(t,a)&&(e[a]=t[a]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},it={}.hasOwnProperty,rt=[].slice,st=function(e,t){return function(){return e.apply(t,arguments)}};L={},h=10,J=!1,R=null,v=null,q=null,P=null,tt=null,a={BEFORE_CHANGE:"page:before-change",FETCH:"page:fetch",RECEIVE:"page:receive",CHANGE:"page:change",UPDATE:"page:update",LOAD:"page:load",RESTORE:"page:restore",BEFORE_UNLOAD:"page:before-unload",EXPIRE:"page:expire"},x=function(e){var t;return e=new n(e),Y(),c(),null!=R&&R.start(),J&&(t=K(e.absolute))?(k(t),T(e,null,!1)):T(e,Q)},K=function(e){var t;return t=L[e],t&&!t.transitionCacheDisabled?t:void 0},b=function(e){return null==e&&(e=!0),J=e},y=function(e){return null==e&&(e=!0),u?e?null!=R?R:R=new r("html"):(null!=R&&R.uninstall(),R=null):void 0},T=function(e,t,n){return null==n&&(n=!0),Z(a.FETCH,{url:e.absolute}),null!=tt&&tt.abort(),tt=new XMLHttpRequest,tt.open("GET",e.withoutHashForIE10compatibility(),!0),tt.setRequestHeader("Accept","text/html, application/xhtml+xml, application/xml"),tt.setRequestHeader("X-XHR-Referer",P),tt.onload=function(){var n;return Z(a.RECEIVE,{url:e.absolute}),(n=I())?(z(e),H(),f.apply(null,$(n)),A(),"function"==typeof t&&t(),Z(a.LOAD)):document.location.href=_()||e.absolute},R&&n&&(tt.onprogress=function(){return function(e){var t;return t=e.lengthComputable?e.loaded/e.total*100:R.value+(100-R.value)/10,R.advanceTo(t)}}(this)),tt.onloadend=function(){return tt=null},tt.onerror=function(){return document.location.href=e.absolute},tt.send()},k=function(e){return null!=tt&&tt.abort(),f(e.title,e.body),U(e),Z(a.RESTORE)},c=function(){var e;return e=new n(v.url),L[e.absolute]={url:e.relative,body:document.body,title:document.title,positionY:window.pageYOffset,positionX:window.pageXOffset,cachedAt:(new Date).getTime(),transitionCacheDisabled:null!=document.querySelector("[data-no-transition-cache]")},m(h)},j=function(e){return null==e&&(e=h),/^[\d]+$/.test(e)?h=parseInt(e):void 0},m=function(e){var t,n,i,r,s,o;for(s=Object.keys(L),t=s.map(function(e){return L[e].cachedAt}).sort(function(e,t){return t-e}),o=[],n=0,r=s.length;r>n;n++)i=s[n],L[i].cachedAt<=t[e]&&(Z(a.EXPIRE,L[i]),o.push(delete L[i]));return o},f=function(t,n,i,r){return Z(a.BEFORE_UNLOAD),document.title=t,document.documentElement.replaceChild(n,document.body),null!=i&&e.update(i),G(),r&&w(),v=window.history.state,null!=R&&R.done(),Z(a.CHANGE),Z(a.UPDATE)},w=function(){var e,t,n,a,i,r,s,o,l,u,d,c;for(c=Array.prototype.slice.call(document.body.querySelectorAll('script:not([data-turbolinks-eval="false"])')),n=0,i=c.length;i>n;n++)if(d=c[n],""===(l=d.type)||"text/javascript"===l){for(t=document.createElement("script"),u=d.attributes,a=0,r=u.length;r>a;a++)e=u[a],t.setAttribute(e.name,e.value);d.hasAttribute("async")||(t.async=!1),t.appendChild(document.createTextNode(d.innerHTML)),o=d.parentNode,s=d.nextSibling,o.removeChild(d),o.insertBefore(t,s)}},X=function(e){return e.innerHTML=e.innerHTML.replace(/<noscript[\S\s]*?<\/noscript>/gi,""),e},G=function(){var e,t;return e=(t=document.querySelectorAll("input[autofocus], textarea[autofocus]"))[t.length-1],e&&document.activeElement!==e?e.focus():void 0},z=function(e){return(e=new n(e)).absolute!==P?window.history.pushState({turbolinks:!0,url:e.absolute},"",e.absolute):void 0},H=function(){var e,t;return(e=tt.getResponseHeader("X-XHR-Redirected-To"))?(e=new n(e),t=e.hasNoHash()?document.location.hash:"",window.history.replaceState(window.history.state,"",e.href+t)):void 0},_=function(){var e;return null!=(e=tt.getResponseHeader("Location"))&&new n(e).crossOrigin()?e:void 0},Y=function(){return P=document.location.href},B=function(){return window.history.replaceState({turbolinks:!0,url:document.location.href},"",document.location.href)},V=function(){return v=window.history.state},A=function(){var e;return navigator.userAgent.match(/Firefox/)&&!(e=new n).hasNoHash()?(window.history.replaceState(v,"",e.withoutHash()),document.location.hash=e.hash):void 0},U=function(e){return window.scrollTo(e.positionX,e.positionY)},Q=function(){return document.location.hash?document.location.href=document.location.href:window.scrollTo(0,0)},p=function(e){var t,n,a;if(null==e||"object"!=typeof e)return e;t=new e.constructor;for(n in e)a=e[n],t[n]=p(a);return t},O=function(e){var t,n;return n=(null!=(t=document.cookie.match(new RegExp(e+"=(\\w+)")))?t[1].toUpperCase():void 0)||"",document.cookie=e+"=; expires=Thu, 01-Jan-70 00:00:01 GMT; path=/",n},Z=function(e,t){var n;return"undefined"!=typeof Prototype&&Event.fire(document,e,t,!0),n=document.createEvent("Events"),t&&(n.data=t),n.initEvent(e,!0,!0),document.dispatchEvent(n)},F=function(e){return!Z(a.BEFORE_CHANGE,{url:e})},I=function(){var e,t,n,a,i,r;return t=function(){var e;return 400<=(e=tt.status)&&600>e},r=function(){var e;return null!=(e=tt.getResponseHeader("Content-Type"))&&e.match(/^(?:text\/html|application\/xhtml\+xml|application\/xml)(?:;|$)/)},a=function(e){var t,n,a,i,r;for(i=e.querySelector("head").childNodes,r=[],t=0,n=i.length;n>t;t++)a=i[t],null!=("function"==typeof a.getAttribute?a.getAttribute("data-turbolinks-track"):void 0)&&r.push(a.getAttribute("src")||a.getAttribute("href"));return r},e=function(e){var t;return q||(q=a(document)),t=a(e),t.length!==q.length||i(t,q).length!==q.length},i=function(e,t){var n,a,i,r,s;for(e.length>t.length&&(i=[t,e],e=i[0],t=i[1]),r=[],n=0,a=e.length;a>n;n++)s=e[n],nt.call(t,s)>=0&&r.push(s);return r},!t()&&r()&&(n=g(tt.responseText),n&&!e(n))?n:void 0},$=function(t){var n;return n=t.querySelector("title"),[null!=n?n.textContent:void 0,X(t.querySelector("body")),e.get(t).token,"runScripts"]},e={get:function(e){var t;return null==e&&(e=document),{node:t=e.querySelector('meta[name="csrf-token"]'),token:null!=t&&"function"==typeof t.getAttribute?t.getAttribute("content"):void 0}},update:function(e){var t;return t=this.get(),null!=t.token&&null!=e&&t.token!==e?t.node.setAttribute("content",e):void 0}},g=function(e){var t;return t=document.documentElement.cloneNode(),t.innerHTML=e,t.head=t.querySelector("head"),t.body=t.querySelector("body"),t},n=function(){function e(t){return this.original=null!=t?t:document.location.href,this.original.constructor===e?this.original:void this._parse()}return e.prototype.withoutHash=function(){return this.href.replace(this.hash,"").replace("#","")},e.prototype.withoutHashForIE10compatibility=function(){return this.withoutHash()},e.prototype.hasNoHash=function(){return 0===this.hash.length},e.prototype.crossOrigin=function(){return this.origin!==(new e).origin},e.prototype._parse=function(){var e;return(null!=this.link?this.link:this.link=document.createElement("a")).href=this.original,e=this.link,this.href=e.href,this.protocol=e.protocol,this.host=e.host,this.hostname=e.hostname,this.port=e.port,this.pathname=e.pathname,this.search=e.search,this.hash=e.hash,this.origin=[this.protocol,"//",this.hostname].join(""),0!==this.port.length&&(this.origin+=":"+this.port),this.relative=[this.pathname,this.search,this.hash].join(""),this.absolute=this.href},e}(),i=function(e){function t(e){return this.link=e,this.link.constructor===t?this.link:(this.original=this.link.href,this.originalElement=this.link,this.link=this.link.cloneNode(!1),void t.__super__.constructor.apply(this,arguments))}return at(t,e),t.HTML_EXTENSIONS=["html"],t.allowExtensions=function(){var e,n,a,i;for(n=1<=arguments.length?rt.call(arguments,0):[],a=0,i=n.length;i>a;a++)e=n[a],t.HTML_EXTENSIONS.push(e);return t.HTML_EXTENSIONS},t.prototype.shouldIgnore=function(){return this.crossOrigin()||this._anchored()||this._nonHtml()||this._optOut()||this._target()},t.prototype._anchored=function(){return(this.hash.length>0||"#"===this.href.charAt(this.href.length-1))&&this.withoutHash()===(new n).withoutHash()},t.prototype._nonHtml=function(){return this.pathname.match(/\.[a-z]+$/g)&&!this.pathname.match(new RegExp("\\.(?:"+t.HTML_EXTENSIONS.join("|")+")?$","g"))},t.prototype._optOut=function(){var e,t;for(t=this.originalElement;!e&&t!==document;)e=null!=t.getAttribute("data-no-turbolink"),t=t.parentNode;return e},t.prototype._target=function(){return 0!==this.link.target.length},t}(n),t=function(){function e(e){this.event=e,this.event.defaultPrevented||(this._extractLink(),this._validForTurbolinks()&&(F(this.link.absolute)||et(this.link.href),this.event.preventDefault()))}return e.installHandlerLast=function(t){return t.defaultPrevented?void 0:(document.removeEventListener("click",e.handle,!1),document.addEventListener("click",e.handle,!1))},e.handle=function(t){return new e(t)},e.prototype._extractLink=function(){var e;for(e=this.event.target;e.parentNode&&"A"!==e.nodeName;)e=e.parentNode;return"A"===e.nodeName&&0!==e.href.length?this.link=new i(e):void 0},e.prototype._validForTurbolinks=function(){return null!=this.link&&!(this.link.shouldIgnore()||this._nonStandardClick())},e.prototype._nonStandardClick=function(){return this.event.which>1||this.event.metaKey||this.event.ctrlKey||this.event.shiftKey||this.event.altKey},e}(),r=function(){function e(e){this.elementSelector=e,this._trickle=st(this._trickle,this),this.value=0,this.content="",this.speed=300,this.opacity=.99,this.install()}var t;return t="turbolinks-progress-bar",e.prototype.install=function(){return this.element=document.querySelector(this.elementSelector),this.element.classList.add(t),this.styleElement=document.createElement("style"),document.head.appendChild(this.styleElement),this._updateStyle()},e.prototype.uninstall=function(){return this.element.classList.remove(t),document.head.removeChild(this.styleElement)},e.prototype.start=function(){return this.advanceTo(5)},e.prototype.advanceTo=function(e){var t;if(e>(t=this.value)&&100>=t){if(this.value=e,this._updateStyle(),100===this.value)return this._stopTrickle();if(this.value>0)return this._startTrickle()}},e.prototype.done=function(){return this.value>0?(this.advanceTo(100),this._reset()):void 0},e.prototype._reset=function(){var e;return e=this.opacity,setTimeout(function(e){return function(){return e.opacity=0,e._updateStyle()}}(this),this.speed/2),setTimeout(function(t){return function(){return t.value=0,t.opacity=e,t._withSpeed(0,function(){return t._updateStyle(!0)})}}(this),this.speed)},e.prototype._startTrickle=function(){return this.trickling?void 0:(this.trickling=!0,setTimeout(this._trickle,this.speed))},e.prototype._stopTrickle=function(){return delete this.trickling},e.prototype._trickle=function(){return this.trickling?(this.advanceTo(this.value+Math.random()/2),setTimeout(this._trickle,this.speed)):void 0},e.prototype._withSpeed=function(e,t){var n,a;return n=this.speed,this.speed=e,a=t(),this.speed=n,a},e.prototype._updateStyle=function(e){return null==e&&(e=!1),e&&this._changeContentToForceRepaint(),this.styleElement.textContent=this._createCSSRule()},e.prototype._changeContentToForceRepaint=function(){return this.content=""===this.content?" ":""},e.prototype._createCSSRule=function(){return this.elementSelector+"."+t+"::before {\n  content: '"+this.content+"';\n  position: fixed;\n  top: 0;\n  left: 0;\n  z-index: 2000;\n  background-color: #0076ff;\n  height: 3px;\n  opacity: "+this.opacity+";\n  width: "+this.value+"%;\n  transition: width "+this.speed+"ms ease-out, opacity "+this.speed/2+"ms ease-in;\n  transform: translate3d(0,0,0);\n}"},e}(),d=function(e){return setTimeout(e,500)},E=function(){return document.addEventListener("DOMContentLoaded",function(){return Z(a.CHANGE),Z(a.UPDATE)},!0)},M=function(){return"undefined"!=typeof jQuery?jQuery(document).on("ajaxSuccess",function(e,t){return jQuery.trim(t.responseText)?Z(a.UPDATE):void 0}):void 0},S=function(e){var t,a;return(null!=(a=e.state)?a.turbolinks:void 0)?(t=L[new n(e.state.url).absolute])?(c(),k(t)):et(e.target.location.href):void 0},C=function(){return B(),V(),document.addEventListener("click",t.installHandlerLast,!0),window.addEventListener("hashchange",function(){return B(),V()},!1),d(function(){return window.addEventListener("popstate",S,!1)})},D=void 0!==window.history.state||navigator.userAgent.match(/Firefox\/2[6|7]/),l=window.history&&window.history.pushState&&window.history.replaceState&&D,s=!navigator.userAgent.match(/CriOS\//),W="GET"===(N=O("request_method"))||""===N,u=l&&s&&W,o=document.addEventListener&&document.createEvent,o&&(E(),M()),u?(et=x,C()):et=function(e){return document.location.href=e},this.Turbolinks={visit:et,pagesCached:j,enableTransitionCache:b,enableProgressBar:y,allowLinkExtensions:i.allowExtensions,supported:u,EVENTS:p(a)}}.call(this),function(e){function t(){var t=n(this);return isNaN(t.datetime)||e(this).text(a(t.datetime)),this}function n(t){if(t=e(t),!t.data("timeago")){t.data("timeago",{datetime:r.datetime(t)});var n=e.trim(t.text());n.length>0&&t.attr("title",n)}return t.data("timeago")}function a(e){return r.inWords(i(e))}function i(e){return(new Date).getTime()-e.getTime()}e.timeago=function(t){return a(t instanceof Date?t:"string"==typeof t?e.timeago.parse(t):e.timeago.datetime(t))};var r=e.timeago;e.extend(e.timeago,{settings:{refreshMillis:6e4,allowFuture:!1,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",numbers:[]}},inWords:function(t){function n(n,i){var r=e.isFunction(n)?n(i,t):n,s=a.numbers&&a.numbers[i]||i;return r.replace(/%d/i,s)}var a=this.settings.strings,i=a.prefixAgo,r=a.suffixAgo;this.settings.allowFuture&&(0>t&&(i=a.prefixFromNow,r=a.suffixFromNow),t=Math.abs(t));var s=t/1e3,o=s/60,l=o/60,u=l/24,d=u/365,c=45>s&&n(a.seconds,Math.round(s))||90>s&&n(a.minute,1)||45>o&&n(a.minutes,Math.round(o))||90>o&&n(a.hour,1)||24>l&&n(a.hours,Math.round(l))||48>l&&n(a.day,1)||30>u&&n(a.days,Math.floor(u))||60>u&&n(a.month,1)||365>u&&n(a.months,Math.floor(u/30))||2>d&&n(a.year,1)||n(a.years,Math.floor(d));return e.trim([i,c,r].join(" "))},parse:function(t){var n=e.trim(t);return n=n.replace(/\.\d\d\d+/,""),n=n.replace(/-/,"/").replace(/-/,"/"),n=n.replace(/T/," ").replace(/Z/," UTC"),n=n.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(n)},datetime:function(t){var n="time"===e(t).get(0).tagName.toLowerCase(),a=e(t).attr(n?"datetime":"title");return r.parse(a)}}),e.fn.timeago=function(){var e=this;e.each(t);var n=r.settings;return n.refreshMillis>0&&setInterval(function(){e.each(t)},n.refreshMillis),e},document.createElement("abbr"),document.createElement("time")}(jQuery),function(e){window.NestedFormEvents=function(){this.addFields=e.proxy(this.addFields,this),this.removeFields=e.proxy(this.removeFields,this)},NestedFormEvents.prototype={addFields:function(t){var n=t.currentTarget,a=e(n).data("association"),i=e("#"+e(n).data("blueprint-id")),r=i.data("blueprint"),s=(e(n).closest(".fields").closestChild("input, textarea, select").eq(0).attr("name")||"").replace(new RegExp("[[a-z_]+]$"),"");if(s)for(var o=s.match(/[a-z_]+_attributes(?=\]\[(new_)?\d+\])/g)||[],l=s.match(/[0-9]+/g)||[],u=0;u<o.length;u++)l[u]&&(r=r.replace(new RegExp("(_"+o[u]+")_.+?_","g"),"$1_"+l[u]+"_"),r=r.replace(new RegExp("(\\["+o[u]+"\\])\\[.+?\\]","g"),"$1["+l[u]+"]"));var d=new RegExp("new_"+a,"g"),c=this.newId();r=e.trim(r.replace(d,c));var h=this.insertFields(r,a,n);return h.trigger({type:"nested:fieldAdded",field:h}).trigger({type:"nested:fieldAdded:"+a,field:h}),!1},newId:function(){return(new Date).getTime()},insertFields:function(t,n,a){var i=e(a).data("target");return i?e(t).appendTo(e(i)):e(t).insertBefore(a)},removeFields:function(t){var n=e(t.currentTarget),a=n.data("association"),i=n.prev("input[type=hidden]");i.val("1");var r=n.closest(".fields");return r.hide(),r.trigger({type:"nested:fieldRemoved",field:r}).trigger({type:"nested:fieldRemoved:"+a,field:r}),!1}},window.nestedFormEvents=new NestedFormEvents,e(document).delegate("form a.add_nested_fields","click",nestedFormEvents.addFields).delegate("form a.remove_nested_fields","click",nestedFormEvents.removeFields)}(jQuery),function(e){e.fn.closestChild=function(t){if(t&&""!=t){var n=[];for(n.push(this);n.length>0;)for(var a=n.shift(),i=a.children(),r=0;r<i.length;++r){var s=e(i[r]);if(s.is(t))return s;n.push(s)}}return e()}}(jQuery);var wloc=window.location.toString();-1!==wloc.indexOf("api")&&wloc.indexOf("api")<10&&-1===wloc.indexOf("charts")&&-1===wloc.indexOf("plugins")&&(window.location=wloc.replace("api","www")),function(e){function t(t,a,i,r){l={dataType:"json"},1===arguments.length&&"string"!=typeof arguments[0]?(l=e.extend(l,t),"url"in l&&"data"in l&&n(l.url,l.data)):(e.isFunction(a)&&(r=i,i=a,a=null),t=n(t,a),l=e.extend(l,{url:t,data:a,success:i,error:r}))}function n(e,t){var n,a,i;for(n in t)i=t[n],a=e.replace("{"+n+"}",i),a!=e&&(e=a,delete t[n]);return e}function a(t){return t.type=t.type||"GET","string"!=typeof t.data&&null!=t.data&&(t.data=e.param(t.data)),t.data=t.data||"",e.restSetup.csrf&&!e.isEmptyObject(e.restSetup.csrf)&&(/^(get)$/i.test(t.type)||/(authenticity_token=)/i.test(t.data)||(t.data+=(t.data?"&":"")+e.restSetup.csrfParam+"="+$restSetup.csrfToken)),/^(get|post)$/i.test(t.type)||(t.data+=(t.data?"&":"")+e.restSetup.methodParam+"="+t.type.toLowerCase(),t.type="POST"),u.call(this,t)}function i(){return t.apply(this,arguments),e.extend(l,{type:"GET"}),e.ajax(l)}function r(){return t.apply(this,arguments),e.extend(l,{type:"POST"}),e.ajax(l)}function s(){return t.apply(this,arguments),e.extend(l,{type:"PUT"}),e.ajax(l)}function o(){return t.apply(this,arguments),e.extend(l,{type:"DELETE"}),e.ajax(l)}e.restSetup={methodParam:"_method"},e(document).on("page:load ready",function(){e.extend(e.restSetup,{csrfParam:e("meta[name=csrf-param]").attr("content"),csrfToken:e("meta[name=csrf-token]").attr("content")})});var l,u=e.ajax;e.extend({ajax:a,read:i,create:r,update:s,destroy:o})}(jQuery),function(e,t,n){var a={required:"The %s field is required.",matches:"The %s field does not match the %s field.",valid_email:"The %s field must contain a valid email address.",min_length:"The %s field must be at least %s characters in length.",max_length:"The %s field must not exceed %s characters in length.",exact_length:"The %s field must be exactly %s characters in length.",greater_than:"The %s field must contain a number greater than %s.",less_than:"The %s field must contain a number less than %s.",alpha:"The %s field must only contain alphabetical characters.",alpha_numeric:"The %s field must only contain alpha-numeric characters.",alpha_dash:"The %s field must only contain alpha-numeric characters, underscores, and dashes.",numeric:"The %s field must contain only numbers.",integer:"The %s field must contain an integer."},i=function(){},r=/^(.+)\[(.+)\]$/,s=/^[0-9]+$/,o=/^\-?[0-9]+$/,l=/^\-?[0-9]*\.?[0-9]+$/,u=/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,6}$/i,d=/^[a-z]+$/i,c=/^[a-z0-9]+$/i,h=/^[a-z0-9_-]+$/i,f=function(e,n,a){for(this.callback=a||i,this.errors=[],this.fields={},this.form=t.forms[e]||{},this.messages={},this.handlers={},e=0,a=n.length;a>e;e++){var r=n[e];r.name&&r.rules&&(this.fields[r.name]={name:r.name,display:r.display||r.name,rules:r.rules,type:null,value:null,checked:null})}this.form.onsubmit=function(e){return function(t){try{return e._validateForm(t)}catch(n){}}}(this)};f.prototype.setMessage=function(e,t){return this.messages[e]=t,this},f.prototype.registerCallback=function(e,t){return e&&"string"==typeof e&&t&&"function"==typeof t&&(this.handlers[e]=t),this},f.prototype._validateForm=function(e){this.errors=[];for(var t in this.fields)if(this.fields.hasOwnProperty(t)){var a=this.fields[t]||{},i=this.form[a.name];i&&i!==n&&(a.type=i.type,a.value=i.value,a.checked=i.checked),this._validateField(a)
}if("function"==typeof this.callback&&this.callback(this.errors,e),this.errors.length>0){if(!e||!e.preventDefault)return!1;e.preventDefault()}return!0},f.prototype._validateField=function(e){var t=e.rules.split("|");if(-1!==e.rules.indexOf("required")||e.value&&""!==e.value&&e.value!==n)for(var i=0,s=t.length;s>i;i++){var o=t[i],l=null,u=!1;if((parts=r.exec(o))&&(o=parts[1],l=parts[2]),"function"==typeof this._hooks[o]?this._hooks[o].apply(this,[e,l])||(u=!0):"callback_"===o.substring(0,9)&&(o=o.substring(9,o.length),"function"==typeof this.handlers[o]&&this.handlers[o].apply(this,[e.value])===!1&&(u=!0)),u){(t=this.messages[o]||a[o])?(e=t.replace("%s",e.display),l&&(e=e.replace("%s",this.fields[l]?this.fields[l].display:l)),this.errors.push(e)):this.errors.push("An error has occurred with the "+e.display+" field.");break}}},f.prototype._hooks={required:function(e){var t=e.value;return"checkbox"===e.type?e.checked===!0:null!==t&&""!==t},matches:function(e,t){return(el=this.form[t])?e.value===el.value:!1},valid_email:function(e){return u.test(e.value)},min_length:function(e,t){return s.test(t)?e.value.length>=t:!1},max_length:function(e,t){return s.test(t)?e.value.length<=t:!1},exact_length:function(e,t){return s.test(t)?e.value.length==t:!1},greater_than:function(e,t){return l.test(e.value)?parseFloat(e.value)>parseFloat(t):!1},less_than:function(e,t){return l.test(e.value)?parseFloat(e.value)<parseFloat(t):!1},alpha:function(e){return d.test(e.value)},alpha_numeric:function(e){return c.test(e.value)},alpha_dash:function(e){return h.test(e.value)},numeric:function(e){return l.test(e.value)},integer:function(e){return o.test(e.value)}},e.FormValidator=f}(window,document),$(document).on("page:load ready",function(){elementPresent($("#channel_form"))&&($(".field_checkbox").click(function(){var e=$(this).val(),t=$("#channel_field"+e);$(this).is(":checked")?(t.removeAttr("readonly"),t.val("Field Label "+e),t.select()):(t.val(""),t.attr("readonly",!0))}),$("#channel_show_location").click(function(){$(this).is(":checked")?($("#channel_longitude").removeAttr("readonly"),$("#channel_latitude").removeAttr("readonly"),$("#label_longitude").removeClass("label-disabled"),$("#label_latitude").removeClass("label-disabled")):($("#channel_longitude").attr("readonly",!0),$("#channel_latitude").attr("readonly",!0),$("#label_longitude").addClass("label-disabled"),$("#label_latitude").addClass("label-disabled"))}),$("#channel_show_video").click(function(){$(this).is(":checked")?($('[name="channel[video_type]"]:radio').removeAttr("disabled"),$("#channel_video_id").removeAttr("readonly"),$("#label_youtube").removeClass("label-disabled"),$("#label_vimeo").removeClass("label-disabled"),$("#label_video_id").removeClass("label-disabled")):($('[name="channel[video_type]"]:radio').attr("disabled",!0),$("#channel_video_id").attr("readonly",!0),$("#label_youtube").addClass("label-disabled"),$("#label_vimeo").addClass("label-disabled"),$("#label_video_id").addClass("label-disabled"))}),$("form").submit(function(){$('[name="channel[video_type]"]:radio').removeAttr("disabled"),unbindBeforeUnloadEvents()}),confirmUnsavedChanges())});var elementPresent=function(e){return"string"==typeof e?0!==$(e).length:0!==e.length};$(window).on("page:load load",function(){var e=-90;$.fn.affix&&(setTimeout(function(){$("#bootstrap-sidebar").affix()},100),$(document.body).scrollspy({target:"#leftcol",offset:300}),$("#bootstrap-sidebar li a[href^='#']").on("click",function(t){t.preventDefault();var n=this.hash;$("html, body").animate({scrollTop:$(this.hash).offset().top+e},300,function(){window.location.hash=n})}))});var q=null;window.PR_SHOULD_USE_CONTINUATION=!0,function(){function e(e){function t(e){var t=e.charCodeAt(0);if(92!==t)return t;var n=e.charAt(1);return(t=c[n])?t:n>="0"&&"7">=n?parseInt(e.substring(1),8):"u"===n||"x"===n?parseInt(e.substring(2),16):e.charCodeAt(1)}function n(e){return 32>e?(16>e?"\\x0":"\\x")+e.toString(16):(e=String.fromCharCode(e),("\\"===e||"-"===e||"["===e||"]"===e)&&(e="\\"+e),e)}function a(e){for(var a=e.substring(1,e.length-1).match(/\\u[\dA-Fa-f]{4}|\\x[\dA-Fa-f]{2}|\\[0-3][0-7]{0,2}|\\[0-7]{1,2}|\\[\S\s]|[^\\]/g),e=[],i=[],r="^"===a[0],s=r?1:0,o=a.length;o>s;++s){var l=a[s];if(/\\[bdsw]/i.test(l))e.push(l);else{var u,l=t(l);o>s+2&&"-"===a[s+1]?(u=t(a[s+2]),s+=2):u=l,i.push([l,u]),65>u||l>122||(65>u||l>90||i.push([32|Math.max(65,l),32|Math.min(u,90)]),97>u||l>122||i.push([-33&Math.max(97,l),-33&Math.min(u,122)]))}}for(i.sort(function(e,t){return e[0]-t[0]||t[1]-e[1]}),a=[],l=[0/0,0/0],s=0;s<i.length;++s)o=i[s],o[0]<=l[1]+1?l[1]=Math.max(l[1],o[1]):a.push(l=o);for(i=["["],r&&i.push("^"),i.push.apply(i,e),s=0;s<a.length;++s)o=a[s],i.push(n(o[0])),o[1]>o[0]&&(o[1]+1>o[0]&&i.push("-"),i.push(n(o[1])));return i.push("]"),i.join("")}function i(e){for(var t=e.source.match(/\[(?:[^\\\]]|\\[\S\s])*]|\\u[\dA-Fa-f]{4}|\\x[\dA-Fa-f]{2}|\\\d+|\\[^\dux]|\(\?[!:=]|[()^]|[^()[\\^]+/g),n=t.length,i=[],o=0,l=0;n>o;++o){var u=t[o];"("===u?++l:"\\"===u.charAt(0)&&(u=+u.substring(1))&&l>=u&&(i[u]=-1)}for(o=1;o<i.length;++o)-1===i[o]&&(i[o]=++r);for(l=o=0;n>o;++o)u=t[o],"("===u?(++l,void 0===i[l]&&(t[o]="(?:")):"\\"===u.charAt(0)&&(u=+u.substring(1))&&l>=u&&(t[o]="\\"+i[l]);for(l=o=0;n>o;++o)"^"===t[o]&&"^"!==t[o+1]&&(t[o]="");if(e.ignoreCase&&s)for(o=0;n>o;++o)u=t[o],e=u.charAt(0),u.length>=2&&"["===e?t[o]=a(u):"\\"!==e&&(t[o]=u.replace(/[A-Za-z]/g,function(e){return e=e.charCodeAt(0),"["+String.fromCharCode(-33&e,32|e)+"]"}));return t.join("")}for(var r=0,s=!1,o=!1,l=0,u=e.length;u>l;++l){var d=e[l];if(d.ignoreCase)o=!0;else if(/[a-z]/i.test(d.source.replace(/\\u[\da-f]{4}|\\x[\da-f]{2}|\\[^UXux]/gi,""))){s=!0,o=!1;break}}for(var c={b:8,t:9,n:10,v:11,f:12,r:13},h=[],l=0,u=e.length;u>l;++l){if(d=e[l],d.global||d.multiline)throw Error(""+d);h.push("(?:"+i(d)+")")}return RegExp(h.join("|"),o?"gi":"g")}function t(e){function t(e){switch(e.nodeType){case 1:if(a.test(e.className))break;for(var n=e.firstChild;n;n=n.nextSibling)t(n);n=e.nodeName,("BR"===n||"LI"===n)&&(i[o]="\n",s[o<<1]=r++,s[o++<<1|1]=e);break;case 3:case 4:n=e.nodeValue,n.length&&(n=l?n.replace(/\r\n?/g,"\n"):n.replace(/[\t\n\r ]+/g," "),i[o]=n,s[o<<1]=r,r+=n.length,s[o++<<1|1]=e)}}var n,a=/(?:^|\s)nocode(?:\s|$)/,i=[],r=0,s=[],o=0;e.currentStyle?n=e.currentStyle.whiteSpace:window.getComputedStyle&&(n=document.defaultView.getComputedStyle(e,q).getPropertyValue("white-space"));var l=n&&"pre"===n.substring(0,3);return t(e),{a:i.join("").replace(/\n$/,""),c:s}}function n(e,t,n,a){t&&(e={a:t,d:e},n(e),a.push.apply(a,e.e))}function a(t,a){function i(e){for(var t=e.d,u=[t,"pln"],d=0,c=e.a.match(r)||[],h={},f=0,p=c.length;p>f;++f){var m,g=c[f],_=h[g],v=void 0;if("string"==typeof _)m=!1;else{var y=s[g.charAt(0)];if(y)v=g.match(y[1]),_=y[0];else{for(m=0;l>m;++m)if(y=a[m],v=g.match(y[1])){_=y[0];break}v||(_="pln")}!(m=_.length>=5&&"lang-"===_.substring(0,5))||v&&"string"==typeof v[1]||(m=!1,_="src"),m||(h[g]=_)}if(y=d,d+=g.length,m){m=v[1];var b=g.indexOf(m),w=b+m.length;v[2]&&(w=g.length-v[2].length,b=w-m.length),_=_.substring(5),n(t+y,g.substring(0,b),i,u),n(t+y+b,m,o(_,m),u),n(t+y+w,g.substring(w),i,u)}else u.push(t+y,_)}e.e=u}var r,s={};!function(){for(var n=t.concat(a),i=[],o={},l=0,u=n.length;u>l;++l){var d=n[l],c=d[3];if(c)for(var h=c.length;--h>=0;)s[c.charAt(h)]=d;d=d[1],c=""+d,o.hasOwnProperty(c)||(i.push(d),o[c]=q)}i.push(/[\S\s]/),r=e(i)}();var l=a.length;return i}function i(e){var t=[],n=[];t.push(e.tripleQuotedStrings?["str",/^(?:'''(?:[^'\\]|\\[\S\s]|''?(?=[^']))*(?:'''|$)|"""(?:[^"\\]|\\[\S\s]|""?(?=[^"]))*(?:"""|$)|'(?:[^'\\]|\\[\S\s])*(?:'|$)|"(?:[^"\\]|\\[\S\s])*(?:"|$))/,q,"'\""]:e.multiLineStrings?["str",/^(?:'(?:[^'\\]|\\[\S\s])*(?:'|$)|"(?:[^"\\]|\\[\S\s])*(?:"|$)|`(?:[^\\`]|\\[\S\s])*(?:`|$))/,q,"'\"`"]:["str",/^(?:'(?:[^\n\r'\\]|\\.)*(?:'|$)|"(?:[^\n\r"\\]|\\.)*(?:"|$))/,q,"\"'"]),e.verbatimStrings&&n.push(["str",/^@"(?:[^"]|"")*(?:"|$)/,q]);var i=e.hashComments;return i&&(e.cStyleComments?(t.push(i>1?["com",/^#(?:##(?:[^#]|#(?!##))*(?:###|$)|.*)/,q,"#"]:["com",/^#(?:(?:define|elif|else|endif|error|ifdef|include|ifndef|line|pragma|undef|warning)\b|[^\n\r]*)/,q,"#"]),n.push(["str",/^<(?:(?:(?:\.\.\/)*|\/?)(?:[\w-]+(?:\/[\w-]+)+)?[\w-]+\.h|[a-z]\w*)>/,q])):t.push(["com",/^#[^\n\r]*/,q,"#"])),e.cStyleComments&&(n.push(["com",/^\/\/[^\n\r]*/,q]),n.push(["com",/^\/\*[\S\s]*?(?:\*\/|$)/,q])),e.regexLiterals&&n.push(["lang-regex",/^(?:^^\.?|[!+-]|!=|!==|#|%|%=|&|&&|&&=|&=|\(|\*|\*=|\+=|,|-=|->|\/|\/=|:|::|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|[?@[^]|\^=|\^\^|\^\^=|{|\||\|=|\|\||\|\|=|~|break|case|continue|delete|do|else|finally|instanceof|return|throw|try|typeof)\s*(\/(?=[^*/])(?:[^/[\\]|\\[\S\s]|\[(?:[^\\\]]|\\[\S\s])*(?:]|$))+\/)/]),(i=e.types)&&n.push(["typ",i]),e=(""+e.keywords).replace(/^ | $/g,""),e.length&&n.push(["kwd",RegExp("^(?:"+e.replace(/[\s,]+/g,"|")+")\\b"),q]),t.push(["pln",/^\s+/,q," \r\n	\xa0"]),n.push(["lit",/^@[$_a-z][\w$@]*/i,q],["typ",/^(?:[@_]?[A-Z]+[a-z][\w$@]*|\w+_t\b)/,q],["pln",/^[$_a-z][\w$@]*/i,q],["lit",/^(?:0x[\da-f]+|(?:\d(?:_\d+)*\d*(?:\.\d*)?|\.\d\+)(?:e[+-]?\d+)?)[a-z]*/i,q,"0123456789"],["pln",/^\\[\S\s]?/,q],["pun",/^.[^\s\w"-$'./@\\`]*/,q]),a(t,n)}function r(e,t){function n(e){switch(e.nodeType){case 1:if(r.test(e.className))break;if("BR"===e.nodeName)a(e),e.parentNode&&e.parentNode.removeChild(e);else for(e=e.firstChild;e;e=e.nextSibling)n(e);break;case 3:case 4:if(l){var t=e.nodeValue,i=t.match(s);if(i){var u=t.substring(0,i.index);e.nodeValue=u,(t=t.substring(i.index+i[0].length))&&e.parentNode.insertBefore(o.createTextNode(t),e.nextSibling),a(e),u||e.parentNode.removeChild(e)}}}}function a(e){function t(e,n){var a=n?e.cloneNode(!1):e,i=e.parentNode;if(i){var i=t(i,1),r=e.nextSibling;i.appendChild(a);for(var s=r;s;s=r)r=s.nextSibling,i.appendChild(s)}return a}for(;!e.nextSibling;)if(e=e.parentNode,!e)return;for(var n,e=t(e.nextSibling,0);(n=e.parentNode)&&1===n.nodeType;)e=n;u.push(e)}var i,r=/(?:^|\s)nocode(?:\s|$)/,s=/\r\n?|\n/,o=e.ownerDocument;e.currentStyle?i=e.currentStyle.whiteSpace:window.getComputedStyle&&(i=o.defaultView.getComputedStyle(e,q).getPropertyValue("white-space"));var l=i&&"pre"===i.substring(0,3);for(i=o.createElement("LI");e.firstChild;)i.appendChild(e.firstChild);for(var u=[i],d=0;d<u.length;++d)n(u[d]);t===(0|t)&&u[0].setAttribute("value",t);var c=o.createElement("OL");c.className="linenums";for(var h=Math.max(0,t-1|0)||0,d=0,f=u.length;f>d;++d)i=u[d],i.className="L"+(d+h)%10,i.firstChild||i.appendChild(o.createTextNode("\xa0")),c.appendChild(i);e.appendChild(c)}function s(e,t){for(var n=t.length;--n>=0;){var a=t[n];y.hasOwnProperty(a)?window.console&&console.warn("cannot override language handler %s",a):y[a]=e}}function o(e,t){return e&&y.hasOwnProperty(e)||(e=/^\s*</.test(t)?"default-markup":"default-code"),y[e]}function l(e){var n=e.g;try{var a=t(e.h),i=a.a;e.a=i,e.c=a.c,e.d=0,o(n,i)(e);var r=/\bMSIE\b/.test(navigator.userAgent),n=/\n/g,s=e.a,l=s.length,a=0,u=e.c,d=u.length,i=0,c=e.e,h=c.length,e=0;c[h]=l;var f,p;for(p=f=0;h>p;)c[p]!==c[p+2]?(c[f++]=c[p++],c[f++]=c[p++]):p+=2;for(h=f,p=f=0;h>p;){for(var m=c[p],g=c[p+1],_=p+2;h>=_+2&&c[_+1]===g;)_+=2;c[f++]=m,c[f++]=g,p=_}for(c.length=f;d>i;){var v,y=u[i+2]||l,b=c[e+2]||l,_=Math.min(y,b),w=u[i+1];if(1!==w.nodeType&&(v=s.substring(a,_))){r&&(v=v.replace(n,"\r")),w.nodeValue=v;var $=w.ownerDocument,x=$.createElement("SPAN");x.className=c[e+1];var k=w.parentNode;k.replaceChild(x,w),x.appendChild(w),y>a&&(u[i+1]=w=$.createTextNode(s.substring(_,y)),k.insertBefore(w,x.nextSibling))}a=_,a>=y&&(i+=2),a>=b&&(e+=2)}}catch(T){"console"in window&&console.log(T&&T.stack?T.stack:T)}}var u=["break,continue,do,else,for,if,return,while"],d=[[u,"auto,case,char,const,default,double,enum,extern,float,goto,int,long,register,short,signed,sizeof,static,struct,switch,typedef,union,unsigned,void,volatile"],"catch,class,delete,false,import,new,operator,private,protected,public,this,throw,true,try,typeof"],c=[d,"alignof,align_union,asm,axiom,bool,concept,concept_map,const_cast,constexpr,decltype,dynamic_cast,explicit,export,friend,inline,late_check,mutable,namespace,nullptr,reinterpret_cast,static_assert,static_cast,template,typeid,typename,using,virtual,where"],h=[d,"abstract,boolean,byte,extends,final,finally,implements,import,instanceof,null,native,package,strictfp,super,synchronized,throws,transient"],f=[h,"as,base,by,checked,decimal,delegate,descending,dynamic,event,fixed,foreach,from,group,implicit,in,interface,internal,into,is,lock,object,out,override,orderby,params,partial,readonly,ref,sbyte,sealed,stackalloc,string,select,uint,ulong,unchecked,unsafe,ushort,var"],d=[d,"debugger,eval,export,function,get,null,set,undefined,var,with,Infinity,NaN"],p=[u,"and,as,assert,class,def,del,elif,except,exec,finally,from,global,import,in,is,lambda,nonlocal,not,or,pass,print,raise,try,with,yield,False,True,None"],m=[u,"alias,and,begin,case,class,def,defined,elsif,end,ensure,false,in,module,next,nil,not,or,redo,rescue,retry,self,super,then,true,undef,unless,until,when,yield,BEGIN,END"],u=[u,"case,done,elif,esac,eval,fi,function,in,local,set,then,until"],g=/^(DIR|FILE|vector|(de|priority_)?queue|list|stack|(const_)?iterator|(multi)?(set|map)|bitset|u?(int|float)\d*)/,_=/\S/,v=i({keywords:[c,f,d,"caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END"+p,m,u],hashComments:!0,cStyleComments:!0,multiLineStrings:!0,regexLiterals:!0}),y={};s(v,["default-code"]),s(a([],[["pln",/^[^<?]+/],["dec",/^<!\w[^>]*(?:>|$)/],["com",/^<\!--[\S\s]*?(?:--\>|$)/],["lang-",/^<\?([\S\s]+?)(?:\?>|$)/],["lang-",/^<%([\S\s]+?)(?:%>|$)/],["pun",/^(?:<[%?]|[%?]>)/],["lang-",/^<xmp\b[^>]*>([\S\s]+?)<\/xmp\b[^>]*>/i],["lang-js",/^<script\b[^>]*>([\S\s]*?)(<\/script\b[^>]*>)/i],["lang-css",/^<style\b[^>]*>([\S\s]*?)(<\/style\b[^>]*>)/i],["lang-in.tag",/^(<\/?[a-z][^<>]*>)/i]]),["default-markup","htm","html","mxml","xhtml","xml","xsl"]),s(a([["pln",/^\s+/,q," 	\r\n"],["atv",/^(?:"[^"]*"?|'[^']*'?)/,q,"\"'"]],[["tag",/^^<\/?[a-z](?:[\w-.:]*\w)?|\/?>$/i],["atn",/^(?!style[\s=]|on)[a-z](?:[\w:-]*\w)?/i],["lang-uq.val",/^=\s*([^\s"'>]*(?:[^\s"'/>]|\/(?=\s)))/],["pun",/^[/<->]+/],["lang-js",/^on\w+\s*=\s*"([^"]+)"/i],["lang-js",/^on\w+\s*=\s*'([^']+)'/i],["lang-js",/^on\w+\s*=\s*([^\s"'>]+)/i],["lang-css",/^style\s*=\s*"([^"]+)"/i],["lang-css",/^style\s*=\s*'([^']+)'/i],["lang-css",/^style\s*=\s*([^\s"'>]+)/i]]),["in.tag"]),s(a([],[["atv",/^[\S\s]+/]]),["uq.val"]),s(i({keywords:c,hashComments:!0,cStyleComments:!0,types:g}),["c","cc","cpp","cxx","cyc","m"]),s(i({keywords:"null,true,false"}),["json"]),s(i({keywords:f,hashComments:!0,cStyleComments:!0,verbatimStrings:!0,types:g}),["cs"]),s(i({keywords:h,cStyleComments:!0}),["java"]),s(i({keywords:u,hashComments:!0,multiLineStrings:!0}),["bsh","csh","sh"]),s(i({keywords:p,hashComments:!0,multiLineStrings:!0,tripleQuotedStrings:!0}),["cv","py"]),s(i({keywords:"caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END",hashComments:!0,multiLineStrings:!0,regexLiterals:!0}),["perl","pl","pm"]),s(i({keywords:m,hashComments:!0,multiLineStrings:!0,regexLiterals:!0}),["rb"]),s(i({keywords:d,cStyleComments:!0,regexLiterals:!0}),["js"]),s(i({keywords:"all,and,by,catch,class,else,extends,false,finally,for,if,in,is,isnt,loop,new,no,not,null,of,off,on,or,return,super,then,true,try,unless,until,when,while,yes",hashComments:3,cStyleComments:!0,multilineStrings:!0,tripleQuotedStrings:!0,regexLiterals:!0}),["coffee"]),s(a([],[["str",/^[\S\s]+/]]),["regex"]),window.prettyPrintOne=function(e,t,n){var a=document.createElement("PRE");return a.innerHTML=e,n&&r(a,n),l({g:t,i:n,h:a}),a.innerHTML},window.prettyPrint=function(e){function t(){for(var n=window.PR_SHOULD_USE_CONTINUATION?u.now()+250:1/0;c<a.length&&u.now()<n;c++){var i=a[c],s=i.className;if(s.indexOf("prettyprint")>=0){var o,f,s=s.match(h);if(f=!s){f=i;for(var p=void 0,m=f.firstChild;m;m=m.nextSibling)var g=m.nodeType,p=1===g?p?f:m:3===g&&_.test(m.nodeValue)?f:p;f=(o=p===f?void 0:p)&&"CODE"===o.tagName}for(f&&(s=o.className.match(h)),s&&(s=s[1]),f=!1,p=i.parentNode;p;p=p.parentNode)if(("pre"===p.tagName||"code"===p.tagName||"xmp"===p.tagName)&&p.className&&p.className.indexOf("prettyprint")>=0){f=!0;break}f||((f=(f=i.className.match(/\blinenums\b(?::(\d+))?/))?f[1]&&f[1].length?+f[1]:!0:!1)&&r(i,f),d={g:s,h:i,i:f},l(d))}}c<a.length?setTimeout(t,250):e&&e()}for(var n=[document.getElementsByTagName("pre"),document.getElementsByTagName("code"),document.getElementsByTagName("xmp")],a=[],i=0;i<n.length;++i)for(var s=0,o=n[i].length;o>s;++s)a.push(n[i][s]);var n=q,u=Date;u.now||(u={now:function(){return+new Date}});var d,c=0,h=/\blang(?:uage)?-([\w.]+)(?!\S)/;t()},window.PR={createSimpleLexer:a,registerLangHandler:s,sourceDecorator:i,PR_ATTRIB_NAME:"atn",PR_ATTRIB_VALUE:"atv",PR_COMMENT:"com",PR_DECLARATION:"dec",PR_KEYWORD:"kwd",PR_LITERAL:"lit",PR_NOCODE:"nocode",PR_PLAIN:"pln",PR_PUNCTUATION:"pun",PR_SOURCE:"src",PR_STRING:"str",PR_TAG:"tag",PR_TYPE:"typ"}}(),!function(e){e(function(){window.prettyPrint&&prettyPrint()})}(window.jQuery),$(document).on("page:load ready",function(){$(".response").click(function(){var e=$(this).data("response_type");$(".response").removeClass("active"),$(".response-"+e).addClass("active"),$(".format").hide(),$(".format-"+e).show()})});var alerts={showBanners:function(e){var t=document.getElementById(e);"none"===t.style.display&&(t.style.display="block")},hideBanners:function(e){var t=document.getElementById(e);"block"===t.style.display&&(t.style.display="none")},displayErrorAlert:function(e){alerts.showBanners(e)}},analysis_visualization_name_save={onmouseclick:function(e,t){$(e).val().trim()?(saveType="mouseClick",e.form.save.click()):alerts.displayErrorAlert(t)},onkeypress:function(e,t){13==event.keyCode&&(event.preventDefault(),$(e).val().trim()?(saveType="enter",e.form.save.click()):alerts.displayErrorAlert(t))}};$("#analysis_name_empty_error_close").on("click",function(){alerts.hideBanners(this.parentElement.id)}),$("#matlab_code_empty_warning_close").on("click",function(){alerts.hideBanners(this.parentElement.id)});var evalContainer,fevalContainer,evalDiv,fevalDiv,fevalImg,editor,hiddenMcode,hiddenErrorTitle,hiddenTimeoutTitle,hiddenSuccessTitle,hiddenErrorMessage,unsavedChangesMessage,errored,erroredMessage,timeOutDetailText,init=function(){evalContainer=$("#eval_container .collapse"),fevalContainer=$("#feval_container .collapse"),evalDiv=$("#eval"),fevalDiv=$("#feval_svg"),fevalImg=$("#feval_png"),hiddenMcode=getHiddenMcodeDiv(),hiddenErrorTitle=$("#error_title").val(),hiddenTimeoutTitle=$("#timeout_title").val(),timeOutDetailText=$("#timeout_detailed").val(),hiddenSuccessTitle=$("#success_title").val(),hiddenErrorMessage=$("#error_message").val(),unsavedChangesMessage=$("#unsaved_changes").val(),errored=$("#errored"),erroredMessage=$("#errored_timecontrol_react").val(),document.getElementById("editor").onload=onEditorLoad,""!==hiddenErrorMessage&&displayError(hiddenErrorMessage),$("#clear").click(function(){clearHistory(),clearFEvalResponse()}),$(window).unbind("beforeunload.matlab").bind("beforeunload.matlab",function(){return editorPresent()&&unsavedChanges()?unsavedChangesMessage:void 0}),$(document).unbind("page:before-change.matlab").bind("page:before-change.matlab",function(){return editorPresent()&&unsavedChanges()&&!confirm(unsavedChangesMessage)?!1:void 0})},onEditorLoad=function(){editor=$(this)[0].contentWindow.editor,editor.setMcode(hiddenMcode.val()),$("#commit").click(function(){editor.lock(),$(".dismiss").click(),hiddenMcode.val(editor.getMcode())}),$("#save").click(function(){"enter"!=saveType&&"mouseClick"!=saveType&&editor.lock(),$(".dismiss").click(),hiddenMcode.val(editor.getMcode())}),$("#editorSpinner").hide(),$(window).on("mouseup",function(e){editorPresent()&&editor.mouseUp(e)})},isPlugin=function(){return elementPresent(fevalContainer)},getHiddenMcodeDiv=function(){var e=isPlugin()?"#plugin_mcode":"#matlab_code_mcode";return $(e)},editorPresent=function(){return elementPresent("#editor")},elementPresent=function(e){return"string"==typeof e?0!==$(e).length:0!==e.length},unsavedChanges=function(){return editor.getMcode()!==hiddenMcode.val()},clearFEvalResponse=function(){elementPresent(fevalDiv)&&fevalDiv.children().remove(),elementPresent(fevalImg)&&(fevalImg.removeAttr("src"),fevalImg.hide())},clearHistory=function(){elementPresent(evalDiv)&&evalDiv.children().remove()},handleMSSResponse=function(e){if("error"in e&&null!==e.error)displayError(e.error);else if(displaySuccess(hiddenSuccessTitle),elementPresent(evalDiv)&&"eval"in e&&appendOutput(e.eval,!1),elementPresent(fevalDiv)&&"feval"in e){var t=e.feval;clearFEvalResponse(),"ggjson"in t&&null!==t.ggjson?handleWebPlotResponse(t.ggjson):"hgplot"in t&&null!==t.hgplot&&handlePlotResponse(t.hgplot)}},handlePlotResponse=function(e){fevalImg.attr("src",e).show()},handleWebPlotResponse=function(e){var t=JSON.parse(e);renderVega(t,"#feval_svg"),fevalImg.hide()},appendOutput=function(e,t){if(""!==e&&null!==e&&void 0!==e){e=e.replace(/\n/g,"<br>");var n=document.createElement("div");if(t===!0&&$(n).addClass("matlab_warning"),n.innerHTML=e,elementPresent(evalDiv)){var a=$(n).find("a");a.length>0&&$(a).click(interceptErrorUrl),$(document.createElement("hr")).appendTo(n),$(n).appendTo(evalDiv),$(evalDiv).scrollTop($(evalDiv).prop("scrollHeight"))}}},displayError=function(e,t){void 0===t&&(t="#root");var n=hiddenErrorTitle;"true"===errored.val()&&(n+=" "+erroredMessage),e===timeOutDetailText&&(n=hiddenTimeoutTitle),$('<div class="flash alert alert-danger"><span class="dismiss">X</span><p>'+n+"</p></div").insertBefore(t),$(".flash a").click(interceptErrorUrl),$(".dismiss").on("click",function(){$(this).parent().remove()}),appendOutput(e,!0)},displaySuccess=function(e,t){void 0===t&&(t="#root"),$(".alert-success").remove(),$('<div class="flash alert alert-success"><span class="dismiss">X</span><p>'+e+"</p></div").insertBefore(t),$(".dismiss").on("click",function(){$(this).parent().remove()}),setTimeout(function(){$("div.flash.alert.alert-success").length>0&&$(".flash").hide("slow")},15e3)},interceptErrorUrl=function(e){"http"!==this.href.substring(0,4)&&(e.preventDefault(),evalErrorUrl(this.href,function(e){null!==e&&"eval"in e&&appendOutput(e.eval,!1)}))},evalErrorUrl=function(e,t){if(-1!==e.indexOf("matlab:")){var n=e.substring(0,7);if("matlab:"===n){var a=e.substring(7);n=a.substring(0,3),"doc"===n?(a=a.substring(4),window.open("http://www.mathworks.com/help/search.html?qdoc="+a)):$.ajax({method:"POST",url:"test_code",data:{mcode:a},dataType:"json"}).done(function(e){t(e)})}}},renderVega=function(e,t){var n=new thingSpeakWebplot;e.resizable=!0,e.resizableButtonVisible=!1,n.setSpec(e,t)!==!1&&(n.loadLibraries(),n.render(),n.resize())};$(document).on("page:load ready",function(){editorPresent()&&init()}),$(document).on("page:load ready",function(){0!==$("#timecontrol_form").length&&(setFrequencyOption(),recurrancyHandler(),fixDateTime(),setWeekdays(),setSchedulable(),$("#timecontrol_run_at").datepicker({format:"yyyy-mm-dd"}),$(".frequency_radio").change(function(){frequencyHandler(),displayFuzzyTimeOptions()}),$(".recurrance_radio").change(function(){recurrancyHandler()}),$("#timecontrol_schedulable_type").change(function(){$("#schedulable").fadeOut(function(){setSchedulable()}),$("#schedulable").fadeIn()}),$("#timecontrol_recurring_minute").change(function(){displayFuzzyTimeOptions()}))});var ThingSpeak=function(e){return e}(ThingSpeak||{}),setExhaustionAlertDefaults=function(){is_shutOff=!1,is_leu=!1,exhuastion_message_id="#call_of_action_exhaust",shut_off_message_id="#call_of_action_shutoff",expire_message_id="#call_of_action_expire",to_expire_message_id="#call_of_action_to_expire",$(".exhaustion_reminder").hide(),$(".expiration_reminder").hide(),$(".shutoff_alert").hide(),$(".shutoff_expiration_alert").hide(),currentDate=new Date,a_tag_id=null},checkMessageExhaustion=function(e,t,n,a,i,r){var s=!1;if(estimated_exhaustion_date=UsageVisualizations.estimateExhaustionOrExpirationDate(a.monthly,a.daily,r).Date,t.dateType=UsageVisualizations.estimateExhaustionOrExpirationDate(a.monthly,a.daily,r).DateType,1==is_shutOff)$("#license_id_val").text(e),$("#shut_off_date").text(moment(t.exhaustion_date).format("LL")),$(".shutoff_alert").show(),void 0!=i&&i===!0&&(s=!0);else if(void 0!=t.dateType&&"Expiration Date"===t.dateType&&estimated_exhaustion_date<currentDate)setExpirationAlert(e,n,!0),$("#license_id_val_expire_shutoff").text(e),$("#shut_off_date_exp").text(moment(estimated_exhaustion_date).add(1,"days").format("LL")),n||$(".shutoff_expiration_alert").show();else{var o=Math.abs(estimated_exhaustion_date.getTime()-(new Date).getTime()),l=Math.ceil(o/864e5);45>=l&&(s=!0,void 0!=t.dateType&&"Expiration Date"===t.dateType?($("#license_id_val_expire").text(e),$("#expiration_date").text(moment(estimated_exhaustion_date).add(1,"days").format("LL")),n||(setExpirationAlert(e,n,!1),$(".expiration_reminder").show())):(setExpirationAlert(e,n,!1),$("#license_id_val_exhaust").text(e),$("#exp_expiration_date").text(moment(estimated_exhaustion_date).format("LL")),$(".exhaustion_reminder").show()))}void 0!=i&&i===!0&&s===!0&&$("#monthly_usage_tab").is(":visible")&&$('#charts_tabs a[href="#monthly_usage"').tab("show")},populateFreeUnitsLink=function(){1!=is_shutOff?$(exhuastion_message_id).attr("href","/prices"):$(shut_off_message_id).attr("href","/prices")},populateAlertMessages=function(e,t){1==is_leu?setMessageForLEU(t):setMessageForNonLEU(e,t)},setMessageForLEU=function(e){setAdminContactMessage(1!=e?exhuastion_message_id:shut_off_message_id)},setMessageForNonLEU=function(e,t){1!=t?setPurchaseUnitsMessage(exhuastion_message_id,e):setPurchaseUnitsMessage(shut_off_message_id,e)},populatePurchaseUnitsLink=function(e){$("#purchase_units_link").attr("href","/account/purchase/"+encodeURIComponent(e))},setAdminContactMessage=function(e){$(e).text("Contact your administrator.").removeClass("exhaustion_alert").removeAttr("href").addClass("contact_admin")},setPurchaseUnitsMessage=function(e,t){$(e).text("Purchase more units").attr("href","/account/purchase/"+encodeURIComponent(t)).attr("data-no-turbolink",!0)},setExpirationAlert=function(e,t,n){a_tag_id=1==n?expire_message_id:to_expire_message_id,1==t?$(a_tag_id).attr("href","/prices"):1==is_leu?$(a_tag_id).text("Contact your administrator.").removeClass("exhaustion_alert").removeAttr("href").addClass("contact_admin"):$(a_tag_id).text("Purchase more units").attr("href","/account/purchase/"+encodeURIComponent(e)).attr("data-no-turbolink",!0)};ThingSpeak.Channel=function(){function e(e){this.channel=e.channel,this.publicView=e.public_view,this.currentUserOwns=e.current_user_owns,this.windows=[],$("abbr.timeago").timeago();for(var t in e.windows)this.windows.push(ThingSpeak.Window.init(e.windows[t],this.currentUserOwns));if($("#add_visualization_modal").on("show.bs.modal",function(){hiddenText=$("#add_visualization_empty_text"),$("#add_visualization_modal_content_body").children("div").length>0?hiddenText.attr("hidden","hidden"):hiddenText.removeAttr("hidden")}),$(".window-preview-container").click(function(){$(this).toggleClass("window-preview-container-selected")}),$("#add_visualization_cancel").click(function(){$(".window-preview-container-selected").removeClass("window-preview-container-selected")}),$("#add_visualization_save").click(function(){var e=this.publicView,t=[],n={};$(".window-preview-container-selected").each(function(a,i){$(i).remove(),n={public_flag:e,content_type:$(i).attr("content-type"),content_id:$(i).attr("content-id")},t.push(n)}),ThingSpeak.Window.addVisualizations(this.channel.id,t)}.bind(this)),this.currentUserOwns){var n=function(){var e=[];$(".window-container").each(function(t,n){e.push(n.id.split("_")[1])});var t="/channels/"+this.channel.id+"/windows/reposition",n={public_flag:this.publicView,window_ids:e};$.ajax({url:t,method:"PUT",data:n,dataType:"json"})}.bind(this);this.sortable=Sortable.create($("#windows_container")[0],{sort:!0,delay:0,animation:150,handle:".window-header",draggable:".window-container",scroll:!0,scrollSensitivity:70,scrollSpeed:10,fallbackOnBody:!1,onEnd:n})}return this}var t=function(t){return new e(t)},n=function(e){var t=$.parseHTML(e);$(t).click(function(){$(this).toggleClass("window-preview-container-selected")}),$("#add_visualization_modal_content_body").append(t)};return{init:t,addVisualizationPreview:n}}();var loadMeterData=function(e){var t;$("#available_licenses").change(function(){var e=this.value,t=$("#channel-metadata-id").html();$.ajax({url:"/channels/update_license",method:"POST",data:{channel_id:t,license:e},dataType:"html"})}),t=e.is_free_user?e.free_license_id:e.is_a_staff?e.staff_license_id:$("#available_licenses").val(),loadMeterInfo(t),$("#available_licenses").change(function(){loadMeterInfo($("#available_licenses").val())})},setDefaultsChannels=function(){$("input#upload_csv_channel_btn").removeAttr("disabled")},loadMeterInfo=function(e){setExhaustionAlertDefaults();var t;setDefaultsChannels(),1==meter_data.is_free_user?(1==meter_data.has_exhausted&&(is_shutOff=!0,t="Importing data into a channel requires messages. Buy a new license."),populateFreeUnitsLink()):meter_data.licenses.forEach(function(n){n.license_id==e&&(null!=n.has_exhausted&&(is_shutOff=!0,t="Importing data into a channel requires messages. Purchase more units."),1==n.is_an_leu&&(is_leu=!0,t="Importing data into a channel requires messages. Contact your license administrator."),populatePurchaseUnitsLink(e),populateAlertMessages(e,is_shutOff))}),findDailyAndMonthlyUsage(e),is_shutOff===!0&&($("input#upload_csv_channel_btn").addClass("enable_events_disabled_elements"),$("input#upload_csv_channel_btn").attr("disabled","disabled"),$("input#upload_csv_channel_btn").attr("title",t))},monthlyData,dailyData,findDailyAndMonthlyUsage=function(e){var t=!1,n={daily:void 0,monthly:void 0},a={userType:meter_data.user_type};a.number_of_messages_per_unit="0"==a.userType?meter_data.free_messages_per_year:meter_data.messages_per_paid_unit,meter_data.is_free_user||jQuery.isEmptyObject(meter_data.licenses)||meter_data.licenses.forEach(function(n){n.license_id==e&&(t=n.is_an_leu)});var i=function(e){n.daily=e,s(n)},r=function(e){n.monthly=e,s(n)},s=function(t){t.daily&&t.monthly&&checkMessageExhaustion(e,meter_data,meter_data.is_free_user,n,!1,a)},o=5e3;$.ajax({url:"/account/daily_usage.json",cache:!1,data:{lid:e,is_an_leu:t},dataType:"json",tryCount:0,retryLimit:1,timeout:o}).done(i).fail(function(e){if(200==e.status||304==e.status);else if(this.tryCount++,this.tryCount<=this.retryLimit)return void $.ajax(this)}),$.ajax({url:"/account/monthly_usage.json",cache:!1,data:{lid:e,is_an_leu:t},dataType:"json",tryCount:0,retryLimit:1,timeout:o}).done(r).fail(function(e){if(200==e.status||304==e.status);else if(this.tryCount++,this.tryCount<=this.retryLimit)return void $.ajax(this)})};ThingSpeak.Window=function(){function e(e,t){return this.initialize=function(e,t){for(var n in e)this[n]=e[n];return null!==this.html&&$("#windows_container").append($.parseHTML(this.html)),this.container=$("#window_"+this.id),this.iframeModal=$("#window_iframe_modal_"+this.id),this.iframe=$("#window_iframe_"+this.id),t&&(this.optionsModal=$("#window_options_modal_"+this.id),this.options_json=JSON.parse(this.options_json),$(this.container).find("#remove_window_"+this.id).click(this.remove.bind(this)),$("#window_options_modal_save_"+this.id).click(this.update_options.bind(this)),$(this.optionsModal).on("hidden.bs.modal",this.reset_options.bind(this)),$(this.optionsModal).find(".mutuallyexclusive").change(function(e){var t=$(e.target),n=t.attr("id");t.parents("div.modal-body").find(".mutuallyexclusive").each(function(e,t){t.id!==n&&$(t).val("")})}),this.reset_options()),this},this.update_options=function(){var e=function(){var e={},t=function(){var t=this.id.split("_")[1],n=$(this).val();""!=n&&(e[t]=n)};return this.optionsModal.find(".form-control").each(t),e}.bind(this),t=function(e){this.iframe_html=e.iframe_html,this.iframe_src=e.iframe_src,this.options=e.options,this.options_json=JSON.parse(e.options_json),$(this.iframe)[0].src=this.iframe_src,$(this.iframeModal).find("pre").text(this.iframe_html),$(this.optionsModal).modal("hide")}.bind(this),n={window_update:"chart_options",options:e()};this.post(n,"json",t)},this.reset_options=function(){var e=this.options_json,t=function(){var t=this.id.split("_")[1];$(this).val(e[t])};this.optionsModal.find(".form-control").each(t)},this.remove=function(){$(this.container).remove();
var e={window_update:"remove"};this.post(e,"script")},this.post=function(e,t,n,a){$.ajax({method:"PUT",url:this.url,data:e,dataType:t}).done(n).error(a)},this.initialize(e,t)}var t=function(t,n){return new e(t,n)},n=function(e,t){data={windows:JSON.stringify(t)},$.ajax({method:"POST",url:"/channels/"+e+"/windows",data:data,dataType:"script"})};return{init:t,addVisualizations:n}}(),$(document).on("page:load ready",function(){function e(){1==plugin_public_flag?($("#url_checkbox").attr("checked","checked"),i()):($("#url_checkbox").removeAttr("checked"),r())}if(elementPresent($("#channel_ids"))||elementPresent($("#visualization_url_div"))){if(elementPresent($("#channel_ids")))var t=(JSON.parse($("#channel_ids").val()),JSON.parse($("#public_channel_ids").val())),n=$("#visualization_is_private_text").val();var a={displaySharingError:function(){$("#visualization_name_empty_error").show()},displayFlagSaveError:function(){$("#visualization_flag_save_error").show()}},i=function(){$("#visualization_URL").prop("placeholder",""),$("#visualization_URL").prop("value",visualization_url),document.getElementById("visualization_URL").style.cursor="default",$("#copy_button").show(),$("#visualization_child_div").addClass("input-group")},r=function(){$("#visualization_URL").prop("placeholder",""),$("#visualization_URL").prop("value",""),document.getElementById("visualization_URL").style.cursor="not-allowed",$("#copy_button").hide()};elementPresent($("#visualization_url_div"))&&e(),$("#visualization_text_field").on("change",function(){$(this).val().trim()?(saveType="mouseClick",this.form.save.click()):a.displaySharingError()}),$("#visualization_text_field").on("keypress",function(e){13==e.keyCode&&(e.preventDefault(),$(this).val().trim()?(saveType="enter",this.form.save.click()):a.displaySharingError())}),$("#url_checkbox").on("click",function(){if(this.checked){if(plugin_public_flag=!0,elementPresent($("#channel_ids")))for(var e=0;e<t.length;e++)$("#public_"+t[e]).attr("disabled",!1).removeAttr("title")}else if(plugin_public_flag=!1,elementPresent($("#channel_ids")))for(var e=0;e<t.length;e++)$("#public_"+t[e]).attr("checked",!1).attr("title",n).attr("disabled",!0);s(!plugin_public_flag),o()});var s=function(e){1==e?r():i()},o=function(){var e="/plugins/"+plugin_id,t={plugin_public_flag:plugin_public_flag};$.ajax({url:e,method:"PUT",data:t}).fail(function(){a.displayFlagSaveError()})};elementPresent($("#channel_ids"))&&($.tablesorter.addParser({id:"checkbox",is:function(){return!1},format:function(e,t,n){return $(n).children().last().is(":checked")?1:0},type:"numeric"}),$("#add_to_channel_table").tablesorter({headers:{2:{sorter:"checkbox"},3:{sorter:"checkbox"}},widgets:["stickyHeaders"],widgetOptions:{stickyHeaders_attachTo:".add-to-channel-table"},initialized:function(e){var t=!1;$(e).find("input[type=checkbox]").each(function(){$(this).bind("change",function(){$(e).trigger("updateCell",[$(this).closest("td")[0],t])})})}}))}});var elementPresent=function(e){return"string"==typeof e?0!==$(e).length:0!==e.length},usageVisualizationCharts=null;UsageVisualizations=function(){function e(e,t){var n=new Date;n=new Date(n.getFullYear(),n.getMonth()+1,n.getDate());for(var a=0,i=0,r=0;r<e.units.length;r++)if(void 0!==e.units[r].endDate&&new Date(e.units[r].endDate).getTime()>=n.getTime()&&void 0!==e.units[r].qty&&(a+=e.units[r].qty*t,void 0!==e.units[r].usages))for(var s=0;s<e.units[r].usages.length;s++)if(void 0!==e.units[r].usages[s].months)for(var o=0;o<e.units[r].usages[s].months.length;o++)e.units[r].qty>0&&(i+=e.units[r].usages[s].months[o]);var l={};return l[0]=a,l[1]=i,l}function t(t,n){var a={};a[0]="Invalid Date",a[1]="Unknown Monthly Usage";var i=new Date,s=new Date(i.getTime()-30*r);s<new Date("2016-12-05")&&(s=new Date("2016-12-05"));var o=s.getYear()+1900,l=i.getMonth()-1,u=s.getMonth();if(1>l&&(l=12),void 0===t||void 0===t.units)return a;for(var d=0,c=[],h=0,f=0;f<t.units.length;f++)if(void 0!==t.units[f].usages)for(var p=0;p<t.units[f].usages.length;p++)if(void 0!==t.units[f].usages[p].year&&t.units[f].usages[p].year>=o&&void 0!==t.units[f].usages[p].months)for(var m=0;m<t.units[f].usages[p].months.length;m++)if(m>=u&&l>=m){var g=new Date(t.units[f].endDate);t.units[f].qty>0&&g>=s&&(c[h]=[t.units[f].usages[p].year,m],h+=1,d+=t.units[f].usages[p].months[m])}for(var _,v=[],f=0;f<c.length;f++){_=0;for(var p=0;p<v.length;p++)c[f][0]===v[p][0]&&c[f][1]===v[p][1]&&(_=1);0===_&&v.push(c[f])}var y=0;v.length>0&&(y=d/v.length);var b=e(t,n),w=b[0],$=b[1],x=new Date((new Date).getTime()+366*r);return y>0&&(x=new Date((new Date).getTime()+30*r*Math.floor((w-$)/y))),"Invalid Date"===x.toDateString()&&(x=new Date((new Date).getTime()+366*r)),a[0]=x,a[1]=y,a}function n(e,n,a){var i=0,u=3e6,d=0,c=1,h=0;void 0!==a&&void 0!==a.userType&&(i=parseInt(a.userType)),void 0!==a&&void 0!==a.number_of_messages_per_unit&&(u=parseInt(a.number_of_messages_per_unit)),void 0!==a&&void 0!==a.display_recommended_units&&(d=parseInt(a.display_recommended_units)),void 0!==a&&void 0!==a.proposed_num_of_units&&(c=parseInt(a.proposed_num_of_units),h=1),1>c&&(c=1);var f={chart:{renderTo:n,animation:!1,type:"column"},title:{text:null},xAxis:{categories:[]},yAxis:{min:0,title:{text:"Messages remaining"},stackLabels:{enabled:!1,style:{fontWeight:"bold"}}},legend:{align:"right",x:-30,verticalAlign:"top",y:25,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"white",borderColor:"#CCC",borderWidth:1,shadow:!1,layout:"vertical"},tooltip:{headerFormat:"<b>{point.x}</b><br/>",pointFormat:"{series.name}: {point.y}<br/>Total: {point.stackTotal}"},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!1}}},series:[],credits:{enabled:!1}};if(void 0===e)return f.chart.height=120,f.yAxis.title.text=null,usageVisualizationCharts=new Highcharts.Chart(f),usageVisualizationCharts.showLoading(1===d?"Not enough data has been collected to display monthly data usage or recommend number of units required at current usage rate. A chart will be populated after at least one month of data has been collected.":"Not enough data has been collected to display monthly data usage. A chart with monthly usage information will be populated after at least one month of data has been collected."),c;if(void 0===e.units||0===e.units.length)return f.chart.height=120,f.yAxis.title.text=null,usageVisualizationCharts=new Highcharts.Chart(f),usageVisualizationCharts.showLoading("This license does not appear to have any available ThingSpeak units."),c;var p=0;for(C=0;C<e.units.length;C++)void 0!==e.units[C].endDate&&e.units[C].qty>0&&e.units[C].usages.length>0&&(p+=1);if(0===p)return f.chart.height=120,f.yAxis.title.text=null,usageVisualizationCharts=new Highcharts.Chart(f),usageVisualizationCharts.showLoading(1===d?"Not enough data has been collected to display monthly data usage or recommend number of units required at current usage rate. A chart will be populated after at least one month of data has been collected.":"A chart with monthly usage information will be populated after at least one month of data has been collected."),c;if(h&&d){var m={},g=new Date;m.id=0,m.qty=c;var _=g.getFullYear(),v=g.getMonth()+1,y=g.getDate();10>v&&(v="0"+v),v>11&&(v="01",_+=1),10>y&&(y="0"+y),m.startDate=_+"-"+v+"-"+y;var b=new Date(g.getTime()+365*r),w=b.getFullYear(),$=b.getMonth()+1,x=b.getDate();10>$&&($="0"+$),$>11&&($="01",w+=1),10>x&&(x="0"+x),m.endDate=w+"-"+$+"-"+x;var k=[{}];k[0].year=g.getFullYear(),k[0].months=[0,0,0,0,0,0,0,0,0,0,0,0],m.usages=k,e.units.push(m)}for(var T=new Date,D=new Date(e.units[0].endDate),C=0;C<e.units.length;C++)if(void 0!==e.units[C].endDate&&e.units[C].qty>0){var E=new Date(e.units[C].endDate);E>T&&(T=new Date(E.getTime())),D>new Date(e.units[C].startDate)&&(D=new Date(e.units[C].startDate))}var S=t(e,u),M=S[0],q=S[1];("Invalid Date"===M.toDateString()||M>=T)&&(M=T);var A=new Date(Math.max(M.getTime(),T.getTime())+31*r),L=new Date(A-424*r);D>L&&(L=D);for(var F=[],C=0;C<e.units.length;C++)if(e.units[C].qty>0&&new Date(e.units[C].endDate)>=L){var j=[],O=[],I=L,R=0;if(0===e.units[C].usages.length){var U=L.getMonth(),N=L.getFullYear();do O.push(0),I=new Date(N+"-"+o[U][0]+"-"+o[U][1]),U+=1,U>11&&(U=0,N+=1);while(A>I);O.splice(O.length-1);var P=L.getMonth()+1;10>P&&(P="0"+P);var z=L.getDate();10>z&&(z="0"+z),j=[e.units[C].id,e.units[C].qty,e.units[C].startDate,e.units[C].endDate,L.getFullYear()+"-"+P+"-"+z,O,R]}else{var H;for(H=0;H<e.units[C].usages.length&&e.units[C].usages[H].year!==L.getFullYear();H++);var U=L.getMonth(),N=L.getFullYear();do I=new Date(N+"-"+o[U][0]+"-"+o[U][1]),O.push(e.units[C].usages.length>H&&void 0!==e.units[C].usages[H].months&&e.units[C].usages[H].months.length>=U?e.units[C].usages[H].months[U]:0),U+=1,U>11&&(U=0,N+=1,H+=1);while(A>I);O.splice(O.length-1);var V=L.getMonth()+1;10>V&&(V="0"+V);var B=L.getDate();10>B&&(B="0"+B),j=[e.units[C].id,e.units[C].qty,e.units[C].startDate,e.units[C].endDate,L.getFullYear()+"-"+V+"-"+B,O,R]}for(var Y=new Date(e.units[C].startDate),E=new Date(e.units[C].endDate),X=0,W=0;W<e.units[C].usages.length;W++)for(var Q=0;Q<e.units[C].usages[W].months.length;Q++){var G=Q>=Y.getMonth(),J=e.units[C].usages[W].year>=Y.getFullYear(),K=Q<L.getMonth(),Z=e.units[C].usages[W].year<=L.getFullYear();G&&J&&K&&Z&&(X+=e.units[C].usages[W].months[Q])}var et=e.units[C].qty*u-X;X===u&&(j[6]=1),j[5][0]=et,F.push(j)}for(var C=0;C<F.length-1;C++)if(new Date(F[C][3])>new Date(F[C+1][3])){var tt=F[C];F[C]=F[C+1],F[C+1]=tt}for(var nt=[],at=[],C=0;C<F.length;C++){var it,H=1,rt=0,st=0,ot=new Date,lt=ot.getMonth()+1;10>lt&&(lt="0"+lt),ot=new Date(ot.getFullYear()+"-"+lt+"-"+o[ot.getMonth()][1]);do{it=new Date(F[C][4]),rt=new Date(F[C][4]).getMonth()+H,st=Math.floor(rt/12),rt%=12;var ut=rt+1;if(10>ut&&(ut="0"+ut),it=new Date(it.getFullYear()+st+"-"+ut+"-"+o[rt][1]),it>=ot)break;F[C][5][H]=F[C][5][H-1]-F[C][5][H],F[C][5][H]<0&&(F[C][5][H]=0),H+=1}while(ot>it&&it<new Date(F[C][3]));at[C]=F[C].slice(),at[C][5]=F[C][5].slice();for(var dt=0;l>dt;dt++)at[C][5][dt]=0;var R=0;rt=new Date(at[C][4]).getMonth()+1;var ut=rt;10>ut&&(ut="0"+ut);var ct=new Date(new Date(at[C][4]).getFullYear()+"-"+ut+"-"+o[rt-1][1]);if(new Date(at[C][3])>new Date&&0===R&&(0===C||nt.length>0&&ct>nt[0]?(at[C][5][H]=F[C][5][H-1]-q,at[C][5][H]<0&&(at[C][5][H]=0,nt[0]=ct,nt[1]=0)):at[C][5][H]=F[C][5][H-1],at[C][5][H]>0))for(var dt=H+1;l-1>dt;dt++){st=0,rt=new Date(at[C][4]).getMonth()+dt,st=Math.floor(rt/12),rt%=12,ut=rt+1,10>ut&&(ut="0"+ut),ct=new Date(new Date(at[C][4]).getFullYear()+st+"-"+ut+"-"+o[rt][1]);var ht=new Date(at[C][3]),ft=ht.getMonth()+1;10>ft&&(ft="0"+ft);var pt=ht.getUTCDate();if(10>pt&&(pt="0"+pt),ht=new Date(ht.getFullYear()+"-"+ft+"-"+pt),ct.getMonth()>ht.getMonth()&&ct.getFullYear()>=ht.getFullYear()){nt[0]=new Date(ct.getTime()),nt[1]=at[C][5][dt-1]>q?0:at[C][5][dt-1]-q;break}if(at[C][5][dt]=0===C||nt.length>0&&ct>=nt[0]?at[C][5][dt-1]-q:at[C][5][dt-1],at[C][5][dt]<0&&(at[C][5][dt]=0,0===R)){nt[0]=new Date(ct.getTime()),nt[1]=-at[C][5][dt],R=1;break}}}for(var C=0;C<F.length-1;C++)if(new Date(F[C][3])>new Date(F[C+1][3])){var tt=F[C];F[C]=F[C+1],F[C+1]=tt;var mt=at[C];at[C]=at[C+1],at[C+1]=mt}var gt=0;do{gt=0;for(var C=0;C<F.length;C++)1===F[C][6]&&(F.splice(C,1),at.splice(C,1),gt=1)}while(1===gt);for(var C=0;C<F.length;C++){var _t=[];L=new Date(F[C][4]);for(var H=0;l>H;H++){var vt=L.getFullYear(),yt=L.getMonth()+H;vt+=Math.floor(yt/12),yt%=12,_t.push([new Date(vt+"-"+o[yt][0][0]+"-"+o[yt][0][1]),F[C][5][H]])}var bt={};bt.name=3==i?"Remaining messages (purchase "+F[C][2]+")":"Remaining messages (free messages start date "+F[C][2]+")",bt.data=_t,bt.color="rgba("+s[C%s.length][0]+","+s[C%s.length][1]+","+s[C%s.length][2]+",1)",f.series.push(bt)}for(var C=0;C<at.length;C++){_t=[],L=new Date(at[C][4]);for(var H=0;l>H;H++)vt=L.getFullYear(),yt=L.getMonth()+H,vt+=Math.floor(yt,12),yt%=12,_t.push([new Date(vt+"-"+o[yt][0][0]+"-"+o[yt][0][1]),at[C][5][H]]);var wt={};wt.name=3==i?"Projected** messages remaining (purchase "+at[C][2]+")":"Projected** messages remaining (free messages renewal date "+at[C][2]+")",wt.data=_t,wt.color="rgba("+s[C%s.length][0]+","+s[C%s.length][1]+","+s[C%s.length][2]+",0.25)",f.series.push(wt)}for(var $t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],xt=new Date(L),kt=xt.getMonth(),Tt=xt.getFullYear(),Dt=0;l>Dt;)f.xAxis.categories.push($t[kt]+" "+Tt),kt++,kt>11&&(kt=0,Tt+=1),Dt++;return f.series.reverse(),usageVisualizationCharts=new Highcharts.Chart(f),h&&d&&e.units.pop(),c}function a(e,t,n,a){var i=0,s=3e6,o=0,l=0,d=0;void 0!==n&&void 0!==n.userType&&(i=parseInt(n.userType)),void 0!==n&&void 0!==n.number_of_messages_per_unit&&(s=parseInt(n.number_of_messages_per_unit)),void 0!==n&&void 0!==n.display_recommended_units&&(o=parseInt(n.display_recommended_units)),void 0!==n&&void 0!==n.proposed_num_of_units&&(l=parseInt(n.proposed_num_of_units),d=1),a=void 0!==a?parseInt(a):1/0;var c={chart:{renderTo:t,animation:!1},title:{text:null},xAxis:{type:"datetime",labels:{rotation:-45},dateTimeLabelFormats:{day:"%e-%b-%Y"},title:{text:null}},yAxis:{min:0,title:{text:"Messages used per day"},stackLabels:{enabled:!1,style:{fontWeight:"bold",color:Highcharts.theme&&Highcharts.theme.textColor||"gray"}}},legend:{align:"right",x:-30,verticalAlign:"top",y:25,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"white",borderColor:"#CCC",borderWidth:1,shadow:!1,layout:"vertical",enabled:!0},tooltip:{formatter:function(){return messageText=1!==this.y?"messages":"message","<b>"+this.y+" "+messageText+"</b> used on "+Highcharts.dateFormat("%e-%b-%Y",new Date(this.x))}},plotOptions:{column:{stacking:"normal",events:{legendItemClick:function(){return!1}},showInLegend:!1,dataLabels:{enabled:!1,color:Highcharts.theme&&Highcharts.theme.dataLabelsColor||"white",style:{textShadow:"0 0 3px black"}}}},series:[{name:"Daily ThingSpeak message usage",data:[],marker:{enabled:!1},enableMouseTracking:!0,type:"column",color:"rgba(6,154,71,1)"}],credits:{enabled:!1}},h=[],f=new Date;f=new Date(f.getFullYear(),f.getMonth(),f.getDate(),0,-1*f.getTimezoneOffset());var p=new Date(f-u*r);if(void 0===e||void 0===e.startDate||void 0===e.datapoints||0===e.datapoints)return c.chart.height=120,c.yAxis.title.text=null,c.xAxis.lineWidth=0,usageVisualizationCharts=new Highcharts.Chart(c),void usageVisualizationCharts.showLoading("Not enough data has been collected to display daily data usage. A chart with daily usage information will be populated after at least one day of data has been collected.");for(var m=new Date(e.startDate).getTime(),g=Math.round((p-m)/r),_=Math.max(0,g),v=0,y=_;y<e.datapoints;y++){var b=new Date(p.valueOf()+(y-g)*r);h[y-_]=[b.getTime(),e.usages[y]],parseInt(e.usages[y])>v&&(v=e.usages[y])}if(0===h.length&&(h[0]=[p.getTime(),0]),h.length<u)for(y=h.length;u>y;y++)b=new Date(h[y-1][0]+1*r),h[y]=[b.getTime(),0];c.series[0].data=h,usageVisualizationCharts=new Highcharts.Chart(c),v>.95*a&&(usageVisualizationCharts.addSeries({name:"Recommended maximum daily usage based on your annual capacity",data:[[p.getTime(),a],[f.getTime(),a]],marker:{enabled:!1},enableMouseTracking:!1,type:"line",color:"rgba(0,0,0,0.7)",dashStyle:"shortdot",events:{legendItemClick:function(){return!1}}}),usageVisualizationCharts.addSeries({name:"",data:[[f.getTime(),1.2*v]],marker:{enabled:!1},enableMouseTracking:!1,type:"line",color:"rgba(0,0,0,0)",showInLegend:!1,events:{legendItemClick:function(){return!1}},visible:!0}))}function i(t,n,a){var i=0,r=3e6,s=0,o=0,l=0;void 0!==a&&void 0!==a.userType&&(i=parseInt(a.userType)),void 0!==a&&void 0!==a.number_of_messages_per_unit&&(r=parseInt(a.number_of_messages_per_unit)),void 0!==a&&void 0!==a.display_recommended_units&&(s=parseInt(a.display_recommended_units)),void 0!==a&&void 0!==a.proposed_num_of_units&&(o=parseInt(a.proposed_num_of_units),l=1);var u={};if(u.Date=new Date((new Date).setFullYear((new Date).getFullYear()+1)),u.DateType="Expiration Date",u.DailyUsageRate=0,void 0===n||void 0===n.usages||0===n.usages.length)return u;if(void 0===t||void 0===t.units||0===t.units.length)return u;for(var d=new Date("2016-12-05"),c=0;c<t.units.length;c++)if(t.units[c].qty>0&&void 0!==t.units[c].endDate&&new Date(t.units[c].endDate)>d){var h=Date.UTC(t.units[c].endDate.split("-")[0],t.units[c].endDate.split("-")[1]-1,t.units[c].endDate.split("-")[2]);d=new Date(h+60*new Date(Date.now()).getTimezoneOffset()*1e3)}for(var f=new Date,p=f.getDate(),m=0,c=1;p>c;c++)m+=parseInt(n.usages[n.usages.length-c]);for(var g=e(t,r),_=g[0],v=g[1]+m,y=_-v,b=0,w=0,$=0,x=0,c=1;31>c;c++)b+=parseInt(n.usages[n.usages.length-c]),16>c&&(w+=parseInt(n.usages[n.usages.length-c])),8>c&&($+=parseInt(n.usages[n.usages.length-c])),2>c&&(x+=parseInt(n.usages[n.usages.length-c]));var k=Math.ceil(b/30),T=Math.ceil(w/15),D=Math.ceil($/7),C=x,E=1e-6;0==k&&(k=E),0==T&&(T=E),0==D&&(D=E),0==C&&(C=E);var S=Math.floor(y/k),M=Math.floor(y/T),q=Math.floor(y/D),A=Math.floor(y/C);S>365&&(S=365),M>365&&(M=365),q>365&&(q=365),A>365&&(A=365);var L=(new Date).getTime(),F=864e5,j=new Date(L+S*F),O=k;return 15*T>y&&(j=new Date(L+M*F),O=T),7*D>y&&(j=new Date(L+q*F),O=D),C>y&&(j=new Date(L+A*F),O=C),(f>j||0>y)&&(j=f),j>d||d.getFullYear()==j.getFullYear()&&d.getMonth()==j.getMonth()&&d.getDate()==j.getDate()?(u.Date=d,u.DateType="Expiration Date"):(u.Date=j,u.DateType="Exhaustion Date"),u.DailyUsageRate=Math.round(O),u}var r=864e5,s=[[0,114,189],[217,83,25],[237,177,32],[126,47,142],[119,172,48],[77,190,238],[162,20,47]],o=[["01",31],["02",28],["03",31],["04",30],["05",31],["06",30],["07",31],["08",31],["09",30],["10",31],["11",30],["12",31]],l=14,u=32;return{updateDailyUsageChart:a,updateMonthlyUsageChart:n,estimateExhaustionOrExpirationDate:i}}(),$(document).on("page:load ready",function(){if(0!==$("#sales_table").length){var e;e=user_info.is_free_user?user_info.free_license_id:user_info.is_a_staff?user_info.staff_license_id:$("#select_license").is("label")?$("#select_license").html():$("#select_license").val(),loadAccountsPage(e),$("#select_license").change(function(){loadAccountsPage($("#select_license").val())}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(){usageVisualizationCharts&&usageVisualizationCharts.reflow();var e,t=/(width: )\w+/,n=document.getElementById("myTabContent").offsetWidth-50,a=$(".highcharts-container").attr("style");void 0!==a&&(e=a.replace(t,"width: "+n+"px"),$(".highcharts-container").attr("style",e));var a=$(".highcharts-loading").attr("style");void 0!==a&&(e=a.replace(t,"width: "+n+"px"),$(".highcharts-loading").attr("style",e))})}});var formatToLocale=function(e){return e=isNaN(parseInt(e))?"":e.toLocaleString()},loadAccountsPage=function(e){if(setExhaustionAlertDefaults(),1==user_info.is_free_user){1==user_info.has_exhausted&&(is_shutOff=!0),$(".admin_div").hide(),$(".leu_div").hide(),$(".nde_leu_div").hide(),$(".nde_admin_div").hide(),$(".free_user_div").show(),$(".staff_div").hide();var t,n,a,i;if(jQuery.isEmptyObject(user_info.licenses)){var r="<tr><td>"+formatToLocale(Math.round(user_info.free_messages_per_year))+'</td><td colspan="2"><span class="text-danger break-word">'+rI18n.license_details_tmp_unavail+"</span></td></tr>";$("#free_user_messages_table").append(r)}else{expirationDateUTC=Date.UTC(user_info.licenses[0].end_date.split("-")[0],user_info.licenses[0].end_date.split("-")[1]-1,user_info.licenses[0].end_date.split("-")[2]),t=new Date(expirationDateUTC+60*new Date(Date.now()).getTimezoneOffset()*1e3),n=(t.getDate()<10?"0":"")+t.getDate(),a=t.toLocaleString("en-us",{month:"short"}),i=t.getFullYear(),messagesRemaining=user_info.licenses[0].messages_remaining;var r="<tr><td>"+formatToLocale(Math.round(user_info.free_messages_per_year))+"</td><td>"+formatToLocale(messagesRemaining)+"</td><td>"+(n+" "+a+" "+i)+"</td></tr>";$("#free_user_messages_table").append(r)}$("#suggested_daily_usage_rate_free_user").html("&nbsp;"+formatToLocale(Math.round(user_info.free_messages_per_year/365))+"&nbsp;messages"),populateFreeUnitsLink()}else $(".free_user_div").hide(),jQuery.isEmptyObject(user_info.licenses)?($(".admin_div").hide(),$(".leu_div").hide(),$(".nde_leu_div").hide(),$(".nde_admin_div").hide(),$(".staff_div").hide(),$(".license_info_unavail_div").show()):user_info.licenses.forEach(function(t){if(t.license_id==e){if(null!=t.has_exhausted&&(is_shutOff=!0),1==t.is_an_leu){is_leu=!0,1==t.is_an_nde_leu?($(".admin_div").hide(),$(".leu_div").hide(),$(".nde_admin_div").hide(),$(".nde_leu_div").show(),$(".staff_div").hide()):t.is_a_staff?($(".admin_div").hide(),$(".nde_leu_div").hide(),$(".nde_admin_div").hide(),$(".leu_div").hide(),$(".staff_div").show()):($(".admin_div").hide(),$(".nde_leu_div").hide(),$(".nde_admin_div").hide(),$(".leu_div").show(),$(".staff_div").hide());var n=!1;user_info.licenses.forEach(function(e){0==e.is_an_leu&&(n=!0)}),n?$(".pricing_link").hide():$(".pricing_link").show()}else 1==t.is_an_nde_admin?($(".admin_div").hide(),$(".leu_div").hide(),$(".nde_leu_div").hide(),$(".staff_div").hide(),$(".nde_admin_div").show()):($(".leu_div").hide(),$(".nde_leu_div").hide(),$(".nde_admin_div").hide(),$(".staff_div").hide(),$(".admin_div").show()),drawUnitsTable(t,e),populatePurchaseUnitsLink(e);populateAlertMessages(e,is_shutOff)}});drawMessageUsageCharts(e),populateLicenceCenterLink(e)},drawUnitsTable=function(e,t){e.is_an_nde_admin?(sales_table=$("#sales_table_nde"),suggested_daily_rate=$("#suggested_daily_usage_rate_nde")):(sales_table=$("#sales_table"),suggested_daily_rate=$("#suggested_daily_usage_rate")),sales_table.find("tbody > tr").remove();var n=[],a=0;user_info.licenses.forEach(function(e){return e.license_id==t?(a+=1,n=e.units,!1):void 0});var i,r,s,o,l,u,d=0,c=[],h=[[0,114,189],[217,83,25],[237,177,32],[126,47,142],[119,172,48],[77,190,238],[162,20,47]],f=0,p=0,m=new Date(1970,1,1);n.forEach(function(e){expirationDateUTC=Date.UTC(e.end_date.split("-")[0],e.end_date.split("-")[1]-1,e.end_date.split("-")[2]),i=new Date(expirationDateUTC+60*new Date(Date.now()).getTimezoneOffset()*1e3),r=(i.getDate()<10?"0":"")+i.getDate(),s=i.toLocaleString("en-us",{month:"short"}),o=i.getFullYear(),u=e.messages_allowed,messagesRemaining=e.messages_remaining,d+=u;var t="rgba("+h[f][0]+","+h[f][1]+","+h[f][2]+",1)";l="<tr><td>"+e.qty+"</td><td>"+formatToLocale(e.messages_allowed)+"</td><td>"+formatToLocale(e.messages_remaining)+"</td><td>"+(r+" "+s+" "+o)+'<div class="units_box" style="background-color:'+t+';"></div></td></tr>',f=(f+1)%h.length,i>new Date?sales_table.append(l):(p+=1,i>m&&(m=i,trHTMLMAX=l),p===n.length&&sales_table.append(trHTMLMAX)),checkForLicenseProdId(c,e,i)}),c.forEach(function(e){checkForUnitExpiration(e)}),user_info.suggestedDailyRate=Math.round(d/365),suggested_daily_rate.html("&nbsp;"+formatToLocale(user_info.suggestedDailyRate)+"&nbsp;messages")},checkForLicenseProdId=function(e,t,n){e.push({key:t,value:n});for(var a in e)e[a].key.licensed_prod_id===t.licensed_prod_id&&1!=e.length&&e[a].key.id!=t.id&&checkDateForRenewal(e[a],n,e,a)},checkDateForRenewal=function(e,t,n,a){e.value<t?n.splice(a,1):n.splice(-1,1)},checkForUnitExpiration=function(e){var t=Math.abs(new Date(e.value).getTime()-(new Date).getTime()),n=Math.ceil(t/864e5),a=e.value.toISOString().split("T")[0]===(new Date).toISOString().split("T")[0];(e.value>new Date||a)&&60>=n&&renderRenewalsDiv(e)},renderRenewalsDiv=function(e){$("#purchase_units_link").addClass("btn-default"),$("#renew_units_link").show();var t='<div class="alert alert-danger alert-dismissable renewals_expiration_alert" style="display:none; clear:both"><a href="#" class="close" data-dismiss="alert" aria-label="close">X</a><span>User purchase made on <strong><span name="renewal_start_date" id="'+e.key.id+'renewal_start_date"></span></strong> is going to expire on: <strong><span name="renewal_expiration_date" id="'+e.key.id+'renewal_expiration_date"></span></strong>.<i class="fa fa-exclamation-triangle" aria-hidden="true"></i><a id="'+e.key.id+'call_of_action_to_renew" class="exhaustion_alert" target="_blank">Renew units</a></span></div>';$("#exhaustion_div").append(t),$("#"+e.key.id+"renewal_start_date").text(moment(new Date(e.key.start_date)).format("LL")),$("#"+e.key.id+"renewal_expiration_date").text(moment(new Date(e.value)).format("LL")),populateRenewUnitsLink(e.key.id),$(".renewals_expiration_alert").show()},populateRenewUnitsLink=function(e){$("#renew_units_link").attr("href","/account/purchase/"+encodeURIComponent(e))},drawMessageUsageCharts=function(e){$("#spinner_daily").show(),$("#spinner_monthly").show();var t=!1;user_info.is_free_user||jQuery.isEmptyObject(user_info.licenses)||user_info.licenses.forEach(function(n){n.license_id==e&&(t=n.is_an_leu)});var n={daily:void 0,monthly:void 0},a={userType:user_info.user_type};a.number_of_messages_per_unit="0"==a.userType?user_info.free_messages_per_year:user_info.messages_per_paid_unit;var i=function(e){n.daily=e,s(n),$("#spinner_daily").hide(),UsageVisualizations.updateDailyUsageChart(e,"dailyMessageUsage",a,user_info.suggestedDailyRate)},r=function(e){n.monthly=e,s(n),$("#monthly_usage_tab").is(":visible")&&($("#spinner_monthly").hide(),UsageVisualizations.updateMonthlyUsageChart(e,"messageUnitUsage",a))},s=function(t){t.daily&&t.monthly&&checkMessageExhaustion(e,user_info,user_info.is_free_user,n,!0,a)},o=5e3,l={url:"/account/daily_usage.json",cache:!1,data:{lid:e,is_an_leu:t},dataType:"json",timeout:o};$.ajax(l).done(i).fail(function(e){304!=e.status?$.ajax(l).done(i).fail(function(){$("#spinner_daily").hide(),$("#dailyMessageUsageTmpUnavail").show()}):($("#spinner_daily").hide(),$("#dailyMessageUsageTmpUnavail").show())}),monthlyAjaxOptions={url:"/account/monthly_usage.json",cache:!1,data:{lid:e,is_an_leu:t},dataType:"json",timeout:o},$.ajax(monthlyAjaxOptions).done(r).fail(function(e){304!=e.status?$.ajax(monthlyAjaxOptions).done(r).fail(function(){$("#spinner_monthly").hide(),$("#messageUnitUsageTmpUnavail").show()}):($("#spinner_monthly").hide(),$("#messageUnitUsageTmpUnavail").show())})},populateLicenceCenterLink=function(e){var t=user_info.license_center_link;t=t.replace(":lid",encodeURIComponent(e)),$("#license_center_link").attr("href",t)},populateRenewUnitsLink=function(e){var t=user_info.licenses[user_info.licenses.length-1].license_id,n=user_info.licenses[user_info.licenses.length-1].units,a=n[n.length-1].licensed_prod_id;renew_link=renew_units_link.replace(":lid",encodeURIComponent(t)),renew_link=renew_link.replace(":pid",encodeURIComponent(a)),$("#"+e+"call_of_action_to_renew").attr("href",renew_link),$("#renew_units_link").attr("href",renew_link)};$(document).on("page:load ready",function(){var e=-90;$(".flash").length>0&&($(".flash").on("click",function(){$(this).hide("slow")}),setTimeout(function(){$("div.flash.alert.alert-success").length>0&&$(".flash").hide("slow")},15e3)),$("#talkback_command_add").click(function(){$(this).hide(),$("#talkback_command_add_form").removeClass("hide")}),$("#contact_link").click(function(){$("#contact_form").toggle()}),$(".tablesorter").length>0&&$(".tablesorter").tablesorter(),$("#userlogin_js").val("6H2W6QYUAJT1Q8EB"),$("input").not(".maxlength_exempt").attr("maxlength","80"),setTimeout(function(){if(""!==window.location.hash){var t=$(window.location.hash).offset().top+e;$(document).scrollTop(t)}},150)});